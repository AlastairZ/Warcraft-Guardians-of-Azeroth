create_artifact_craftsman_effect = { # Base craftsman
	create_random_steward = {
		female = no
		dynasty = none
		random_traits = yes
		historical = yes
	}
	new_character = {
		give_artifact_craftsman_stats_effect = yes
	}
}

create_artifact_craftsman_with_random_culture_effect = { # + craftsman
	create_random_steward = {
		female = no
		dynasty = none
		culture = random
		random_traits = yes
		historical = yes
	}
	new_character = {
		give_artifact_craftsman_stats_effect = yes

		upgrade_artifact_craftsman_stats_effect = yes
		upgrade_artifact_craftsman_stats_effect = yes
	}
}

give_artifact_craftsman_stats_effect = {
	new_character = {

		#Type
		event_target:target_artifact_craftsman_employer = {
			trigger_switch = {
				on_trigger = has_character_flag
				bought_from_blacksmith	= { new_character = { set_character_flag = craftsman_is_blacksmith	}	}
				bought_from_tailor		= { new_character = { set_character_flag = craftsman_is_tailor		}	}
				bought_from_enchanter	= { new_character = { set_character_flag = craftsman_is_enchanter	}	}
				bought_from_alchemist	= { new_character = { set_character_flag = craftsman_is_alchemist	}	}
				bought_from_jeweler		= { new_character = { set_character_flag = craftsman_is_jeweler		}	}
			}
		}

		#Stats
		health = 1

		# Age
		if = {
			limit = {
				immortal = yes
			}

			random_list = {
				5 = { add_age = 40 }
				5 = { add_age = 50 }
				5 = { add_age = 60 }
				5 = { add_age = 70 }
				5 = { add_age = 80 }
				5 = { add_age = 90 }
				5 = { add_age = 100 }
			}
		}

		# Traits
		remove_trait = imbecile
		remove_trait = slow
		remove_trait = dull
		remove_lifestyle_trait_effect = yes

		# LvL
		set_variable = { which = wc_artifact_craftsman_experience_variable value = 1 }

		if = { # Base LvL
			limit = {
				is_dumb_trigger = no
			}

			if = { # Immortals are retarded - made by gang
				limit = {
					immortal = no
				}

				random = {
					chance = 50

					upgrade_artifact_craftsman_stats_effect = yes
				}
			}

			# Free LvLs for Smartasses
			chance_to_upgrade_artifact_craftsman_stats_effect = yes
			chance_to_upgrade_artifact_craftsman_stats_effect = yes
		}

		random = { # Lucky or Not?
			chance = 50

			upgrade_artifact_craftsman_stats_effect = yes
		}

		# LvL from personality
		if = { # Hard worker - Diligent
			limit ={
				trait = diligent
			}

			upgrade_artifact_craftsman_stats_effect = yes
		}

		if = { # Hard worker - Ambitious
			limit ={
				trait = ambitious
				NOT = { trait = slothful }
			}

			upgrade_artifact_craftsman_stats_effect = yes
		}

		if = { # Crazy Genius
			limit = {
				trait = lunatic
				trait = genius
			}

			upgrade_artifact_craftsman_stats_effect = yes
		}

		if = { # Obsessed with work
			limit = {
				trait = possessed
				OR = {
					trait = diligent
					trait = ambitious
				}
				NOT = {
					trait = slothful
					trait = content
				}
			}

			upgrade_artifact_craftsman_stats_effect = yes
		}

		if = { # Drunken Master
			limit ={
				trait = drunkard
				trait = diligent
			}

			upgrade_artifact_craftsman_stats_effect = yes
		}

		# Will not marry
		set_character_flag = ai_flag_refuse_marriage
		set_character_flag = ai_flag_refuse_concubinage
		set_character_flag = cannot_marry
		set_character_flag = no_court_invites
		add_character_modifier = { modifier = will_not_marry duration = -1 }
		add_trait = cannot_marry
		add_trait = cannot_marry_trait
	}
}

upgrade_artifact_craftsman_stats_effect = {

	if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value < 10 } }

		remove_craftsman_lvl_effect = yes
		change_variable = { which = wc_artifact_craftsman_experience_variable value = 1 }
		recheck_craftsman_lvl_effect = yes
	}

}

chance_to_upgrade_artifact_craftsman_stats_effect = {
	if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value < 10 } }

		random = {
			chance = 1

			modifier = {
				factor = 25
				trait = genius
			}
			modifier = {
				factor = 10
				trait = quick
			}
			modifier = {
				factor = 10
				trait = twoheaded
			}
			modifier = {
				factor = 5
				trait = shrewd
			}
			modifier = {
				factor = 2.5
				trait = diligent
			}
			modifier = {
				factor = 2.5
				trait = ambitious
			}

			remove_craftsman_lvl_effect = yes
			change_variable = { which = wc_artifact_craftsman_experience_variable value = 1 }
			recheck_craftsman_lvl_effect = yes
		}
	}
}

remove_craftsman_lvl_effect = {
	remove_character_modifier = modifier_artifact_craftsman_level_1
	remove_character_modifier = modifier_artifact_craftsman_level_2
	remove_character_modifier = modifier_artifact_craftsman_level_3
	remove_character_modifier = modifier_artifact_craftsman_level_4
	remove_character_modifier = modifier_artifact_craftsman_level_5
	remove_character_modifier = modifier_artifact_craftsman_level_6
	remove_character_modifier = modifier_artifact_craftsman_level_7
	remove_character_modifier = modifier_artifact_craftsman_level_8
	remove_character_modifier = modifier_artifact_craftsman_level_9
	remove_character_modifier = modifier_artifact_craftsman_level_10	
}

recheck_craftsman_lvl_effect = {
	if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 10 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_10 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 9 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_9 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 8 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_8 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 7 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_7 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 6 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_6 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 5 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_5 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 4 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_4 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 3 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_3 duration = -1 }
	}
	else_if = {
		limit = { check_variable = { which = wc_artifact_craftsman_experience_variable value == 2 } }

		add_character_modifier = { name = modifier_artifact_craftsman_level_2 duration = -1 }
	}
	else = {
		add_character_modifier = { name = modifier_artifact_craftsman_level_1 duration = -1 }
	}
}

random_spawn_craftsman_candidate_effect = {
	random_list = {
		95 = { # Craftsman
			event_target:target_artifact_craftsman_employer = {
				artifact_craftsman_is_ok_score = yes
			}

			create_artifact_craftsman_with_random_culture_effect = yes
		}
		5 = { # Fraud
			event_target:target_artifact_craftsman_employer = {
				artifact_craftsman_is_fake_score = yes
			}

			create_artifact_craftsman_with_random_culture_effect = yes
			new_character = {
				set_character_flag = craftsman_is_fake
				random = {
					chance = 25

					add_trait = deceitful
				}
				random_list = {
					100 = {  }
					50 = { change_intrigue = 1 }
					250 = { change_intrigue = 3 }
					50 = { change_intrigue = 5 }
					25 = { change_intrigue = 8 }
					5 = { change_intrigue = 10 }
				}
			}
		}
	}
	new_character = {
		event_target:target_artifact_craftsman_employer = {
			export_to_variable = {
				which = wc_artifact_craftsman_finding_realm_size_to_stats_variable
				value = wc_artifact_craftsman_finding_realm_size_variable
				who = PREV
			}
		}
		while = {
			limit = {
				check_variable = {
					which = wc_artifact_craftsman_finding_realm_size_to_stats_variable
					value = 10
				}
			}
			subtract_variable = {
				which = wc_artifact_craftsman_finding_realm_size_to_stats_variable
				value = 10
			}
			upgrade_artifact_craftsman_stats_effect = yes
		}
		#set_variable = { which = wc_artifact_craftsman_finding_realm_size_to_stats_variable value = 0 }
	}
}

artifact_random_up_effect = {
	wealth = local_third_party_score
	random_list = {
		80 = { # success
			custom_tooltip = {
				text = artifact_up_success_tooltip
				character_event = { id = WCAE.3 }
			}
			artifact_up_success_score = yes
		}
		10 = { # minor failure
			custom_tooltip = {
				text = artifact_up_failure_minor_tooltip
				character_event = { id = WCAE.4 }
			}
			artifact_up_failure_score = yes
		}
		5 = { # failure
			custom_tooltip = {
				text = artifact_up_failure_tooltip
				character_event = { id = WCAE.5 }
			}
			artifact_up_failure_score = yes
		}
		5 = { # critical failure
			custom_tooltip = {
				text = artifact_up_critical_failure_tooltip
				character_event = { id = WCAE.6 }
			}
			artifact_up_critical_failure_score = yes
		}
	}
}

remove_artifact_craftsman_will_not_marry_effect = {
	clr_character_flag = ai_flag_refuse_marriage
	clr_character_flag = ai_flag_refuse_concubinage
	clr_character_flag = cannot_marry
	clr_character_flag = no_court_invites
	remove_character_modifier = will_not_marry
	remove_trait = cannot_marry
	remove_trait = cannot_marry_trait
}