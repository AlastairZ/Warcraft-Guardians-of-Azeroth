namespace = WCDRN

############################
#	Crashlanding of Exodar
############################

# Creates the Draenei and characters
character_event = {
	id = WCDRN.99
	
	is_triggered_only = yes
	hide_window = yes
	
	ai = no

	trigger = {
		NOT = { has_global_flag = exodar_has_crashed_flag }
		year = 610
	}
	
	immediate = {
		create_character = {
			name = Velen
			dynasty = 140000
			culture = draenei 
			religion = naaru
			attributes = {
				martial=5 diplomacy=6 stewardship=6 intrigue=3 learning=7
			}
			trait=mastermind_theologian
			trait=creature_draenei
			trait=class_priest_9
			trait=honest trait=patient trait=just trait=zealous trait=kind trait=sorcerer trait=immortal
			age = 600
		}
		new_character = {
			# Saves Velen in event_target:target_velen for future use
			save_event_target_as = target_velen
			
			3320 = {
				# Adds slot and holding because why not?
				if = {
					limit = { NOT = { num_of_max_settlements = 7 } }
					add_holding_slot = 1
				}
				if = {
					limit = { has_empty_holding = yes }
					build_holding = { type = temple holder = event_target:target_velen }
				}
				else = {	# In case when new holding can't be created give just something to save Velen from being landless and game over
					random_province_holding = {
						limit = { is_capital = no }
						preferred_limit = { holding_type = temple }
						grant_title_no_opinion = event_target:target_velen
					}
				}
				
				# Rename one temple as Exodar
				random_province_holding = {
					limit = { holding_type = temple }
					# Prefer when Velen is holder
					preferred_limit = { holder_scope = { character = event_target:target_velen } }
					set_name = "EXODAR"
				}
				
				# Rename province as Exodar
				set_name = "EXODAR"
				culture = event_target:target_velen
				religion = event_target:target_velen
				
				# Gives claim if holder is player or title if holder is AI
				county = { give_claim_or_title_to_prevprev_effect = yes }
				
				# Upgrade tribal if there's one
				if = {
					limit = { any_province_holding = { holding_type = tribal } }
					random_province_holding = {
						limit = { holding_type = tribal }
						convert_tribal_to_temple_effect = yes
					}
				}
			}
			3322 = {
				# Adds slot and holding because why not?
				if = {
					limit = { NOT = { num_of_max_settlements = 7 } }
					add_holding_slot = 1
				}
				if = {
					limit = { has_empty_holding = yes }
					build_holding = { type = castle holder = event_target:target_velen }
				}
				
				culture = event_target:target_velen
				religion = event_target:target_velen
				
				# Gives claim if holder is player or title if holder is AI
				county = { give_claim_or_title_to_prevprev_effect = yes }
				
				# Upgrade tribal if there's one
				if = {
					limit = { any_province_holding = { holding_type = tribal } }
					random_province_holding = {
						limit = { holding_type = tribal }
						convert_tribal_to_castle_effect = yes
					}
				}
			}			
			3324 = {
				# Adds slot and holding because why not?
				if = {
					limit = { NOT = { num_of_max_settlements = 7 } }
					add_holding_slot = 1
				}
				if = {
					limit = { has_empty_holding = yes }
					build_holding = { type = castle holder = event_target:target_velen }
				}
				
				culture = event_target:target_velen
				religion = event_target:target_velen
				
				# Gives claim if holder is player or title if holder is AI
				county = { give_claim_or_title_to_prevprev_effect = yes }
				
				# Upgrade tribal if there's one
				if = {
					limit = { any_province_holding = { holding_type = tribal } }
					random_province_holding = {
						limit = { holding_type = tribal }
						convert_tribal_to_castle_effect = yes
					}
				}
			}
			3326 = {
				# Adds slot and holding because why not?
				if = {
					limit = { NOT = { num_of_max_settlements = 7 } }
					add_holding_slot = 1
				}
				if = {
					limit = { has_empty_holding = yes }
					build_holding = { type = castle holder = event_target:target_velen }
				}
				
				culture = event_target:target_velen
				religion = event_target:target_velen
				
				# Gives claim if holder is player or title if holder is AI
				county = { give_claim_or_title_to_prevprev_effect = yes }
				
				# Upgrade tribal if there's one
				if = {
					limit = { any_province_holding = { holding_type = tribal } }
					random_province_holding = {
						limit = { holding_type = tribal }
						convert_tribal_to_castle_effect = yes
					}
				}
			}			
			activate_title = { title = k_exodar status = yes }
			k_exodar = { gain_title = event_target:target_velen }
			activate_title = { title = d_naaru status = yes }
			d_naaru = { gain_title = event_target:target_velen }			
			narrative_event = { id = WCDRN.100 }
			give_nickname = nick_the_divine
			set_global_flag = exodar_has_crashed_flag	
			set_character_flag = is_velen
			create_character = {
				name = Maraad
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=8 diplomacy=4 stewardship=5 intrigue=2 learning=4
				}
				trait=skilled_tactician
				trait=creature_draenei
				trait=class_paladin_7
				trait=sturdy trait=wroth trait=honest trait=stubborn trait=zealous trait=brave
				age = 400
			}
			create_character = {
				name = Romuul
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=4 diplomacy=4 stewardship=8 intrigue=2 learning=6
				}
				trait=midas_touched
				trait=creature_draenei
				trait=architect
				random_traits=yes
				age = 470
			}
			create_character = {
				name = Menelaous
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=7 diplomacy=4 stewardship=6 intrigue=4 learning=4
				}
				trait=skilled_tactician
				trait=creature_draenei
				random_traits=yes
				age = 380
			}
			new_character = {
				IF = {
					limit = { c_moongraze = { holder = event_target:target_velen } }
					gain_title = c_moongraze
				}
				IF = {
					limit = { b_yllelthyr = { holder = event_target:target_velen } }
					gain_title = b_yllelthyr
				}				
			}			
			create_character = {
				name = Admetius
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=6 diplomacy=5 stewardship=5 intrigue=4 learning=5
				}
				trait=fortune_builder
				trait=creature_draenei
				random_traits=yes
				age = 320
			}
			new_character = {
				IF = {
					limit = { c_wrathscale = { holder = event_target:target_velen } }
					gain_title = c_wrathscale
				}
				IF = {
					limit = { b_ethea_3 = { holder = event_target:target_velen } }
					gain_title = b_ethea_3
				}					
			}
			create_character = {
				name = Iridi
				female = yes
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=5 diplomacy=3 stewardship=4 intrigue=4 learning=8
				}
				trait=scholarly_theologian
				trait=creature_draenei
				trait=class_priest_6
				trait=kind
				trait=sorcerer
				trait=deceitful
				random_traits=yes
				age = 119
			}
			create_character = {
				name = Naielle
				female = yes
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=6 diplomacy=5 stewardship=4 intrigue=5 learning=6
				}
				trait=tough_soldier
				trait=creature_draenei
				trait=class_hunter_7
				random_traits=yes
				age = 320
			}	
			create_character = {
				name = Sulaa
				female = yes
				dynasty = none
				culture = draenei religion = shamanism
				attributes = {
					martial=3 diplomacy=7 stewardship=4 intrigue=4 learning=8
				}
				trait=scholarly_theologian
				trait=creature_draenei
				trait=class_shaman_6
				random_traits=yes
				age = 130
			}
			create_character = {
				name = Boros
				dynasty = none
				culture = draenei religion = naaru
				attributes = {
					martial=8 diplomacy=5 stewardship=5 intrigue=3 learning=7
				}
				trait=brilliant_strategist
				trait=holy_warrior
				trait=creature_draenei
				trait=class_paladin_8			
				trait=zealous
				trait=patient
				trait=brave
				age = 500
			}	
			new_character = {
				activate_title = { title = d_hand_of_argus status = yes }
				d_hand_of_argus = { gain_title = PREV }
				set_defacto_liege = k_exodar
				create_character = {
					name = Kuros
					dynasty = none
					culture = draenei religion = naaru
					attributes = {
						martial=7 diplomacy=6 stewardship=3 intrigue=3 learning=8
					}
					trait=grey_eminence
					trait=creature_draenei
					trait=class_paladin_7
					trait=zealous trait=proud
					random_traits = yes
					age = 450
				}		
				create_character = {
					name = Saruan
					dynasty = none
					culture = draenei religion = naaru
					attributes = {
						martial=7 diplomacy=6 stewardship=4 intrigue=5 learning=6
					}
					trait=brilliant_strategist
					trait=unyielding_leader
					trait=creature_draenei
					trait=class_paladin_8
					trait=zealous
					random_traits = yes
					age = 480
				}
				create_character = {
					name = Aesom
					dynasty = none
					culture = draenei religion = naaru
					attributes = {
						martial=6 diplomacy=4 stewardship=6 intrigue=5 learning=6
					}
					trait=mastermind_theologian
					trait=creature_draenei
					trait=class_paladin_8
					trait=zealous trait=shy
					random_traits = yes
					age = 480
				}
			}
			
			# If Velen has no 3320 province, declares war
			3320 = {
				county = {
					holder_scope = {
						top_liege = {
							# If has 2 or more claims, claims all
							if = {
								limit = {
									event_target:target_velen = {
										total_claims = {
											who = PREV
											strong = yes
											value = 2
										}
									}
								}
								reverse_unsafe_war = {
									target = event_target:target_velen
									casus_belli = claim_all
									thirdparty_title = THIS
								}
							}
							else = {
								reverse_unsafe_war = {
									target = event_target:target_velen
									casus_belli = claim
									thirdparty_title = PREVPREV
								}
							}
						}
					}
				}
			}
		}
	}
}

# Notify the world of the crash, give initial boost for Velen
narrative_event = {
	id = WCDRN.100
	title = EVTTITLE_WCDRN_100
	desc = EVTDESC_WCDRN_100
	picture = GFX_evt_exodar
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes

	major = yes

	hide_from = yes
	
	immediate = {
		3320 = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					home = PREV
					troops = {
						archers = { 1000 1000 }
						light_infantry = { 1500 1500 }
						heavy_infantry = { 1875 1875 }
						light_cavalry = { 250 250 }
						knights = { 375 375 }
					}
					cannot_inherit = no
					attrition = 1.0
					reinforces = yes
					maintenance = no
				}
			}
		}
	}

	option = {
		trigger = { 
			true_religion_group = light_group
		}
		name = EVTOPTA_WCDRN_100
	}
	
	option = {
		trigger = { 
			OR = { 
				true_religion = burning_legion_religion
				true_religion = orcish_fel
			} 
		}
		name = EVTOPTB_WCDRN_100		
	}

	option = {
		trigger = { culture_group = orc_group }
		name = EVTOPTC_WCDRN_100
	}

	option = {		
		trigger = { 
			NOR = { 
				true_religion_group = light_group
				true_religion = burning_legion_religion
				true_religion = orcish_fel				
				culture_group = orc_group
			} 
		}
		name = EVTOPTD_WCDRN_100
	}
}