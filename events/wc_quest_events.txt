namespace = WCCSO

##Mission Tombola
character_event = {
	id = WCQUE.100
	
	is_triggered_only = yes
	hide_window = yes
	
	min_age = 16
	only_capable = yes
	prisoner = no
	is_in_society = yes

	trigger = {
		OR = {
			society_member_of = cult_of_the_damned
			society_member_of = shadow_council
			society_member_of = twilights_hammer_cult
			society_member_of = cenarion_circle
			society_member_of = sisterhood_of_elune
		}
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_society_grandmaster = yes }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				same_society_as = ROOT
			}
			save_event_target_as = grandmaster
		}

		random_list = {
			# Pick Theology focus (vanilla)
			20 = {
				trigger = {
					has_dlc ="Way of Life"
					
					is_playable = yes
					
					OR = {
						society_member_of = cenarion_circle
						society_member_of = sisterhood_of_elune
					}
				}
				set_character_flag = monastic_orders_mission_theology
				event_target:grandmaster = { character_event = { id = MNM.4010 days = 7 random = 7 } }
			}
			
			# Infect the grain (mod)
			20 = {
				modifier = {
					factor = 0
					is_playable = no
				}
				modifier = {
					factor = 0
					NOT = { society_member_of = cult_of_the_damned }
				}
				modifier = {
					factor = 0
					realm = { title = e_scourge }
				}
				modifier = {
					factor = 0
					NOT = {
						any_realm_province = {
							NOT = { religion = death_god }
							NOT = { has_province_modifier = undead_province }
							any_province_holding = { holder_scope = { NOT = { character = ROOT } } }
						}
					}
				}
				event_target:grandmaster = {
					character_event = { id = WCDAC.7023 }
				}
			}

			# Disembowel character (mod)
			20 = {
				modifier = {
					factor = 0
					is_playable = no
				}
				modifier = {
					factor = 0
					NOT = { society_member_of = cult_of_the_damned }
				}
				event_target:grandmaster = {
					character_event = { id = WCDAC.7040 }
				}
			}

			# Turn into undead (mod)
			20 = {
				trigger = {
					ai = no
					is_playable = yes
					
					society_rank > 1
					society_member_of = cult_of_the_damned
					any_courtier = {
						is_potential_turn_into_undead_target_trigger = yes
					}
				}
				event_target:grandmaster = {
					character_event = { id = WCDAC.7050 }
				}
			}

			# Drain a soul (mod)
			20 = {
				modifier = {
					factor = 0
					is_playable = no
				}
				modifier = {
					factor = 0
					NOT = { society_member_of = shadow_council }
				}
				event_target:grandmaster = {
					character_event = { id = WCDAC.8000 }
				}
			}

			# Mind Control (mod)
			20 = {
				trigger = {
					ai = no
					is_playable = yes
					
					society_rank > 2
					OR = {
						society_member_of = shadow_council
						society_member_of = twilights_hammer_cult
					}
					any_courtier = {
						is_potential_mind_control_target_trigger = yes
					}
				}
				event_target:grandmaster = {
					character_event = { id = WCDAC.8010 }
				}
			}

			# Desecrate temple (vanilla)
			20 = {
				trigger = {
					is_playable = yes
					
					OR = {
						society_member_of = shadow_council
						society_member_of = twilights_hammer_cult
					}
					any_realm_province = {
						any_province_holding = {
							holding_type = temple
							holder_scope = {
								# Warcraft
								evil_public_religion_trigger = no
								NOT = { religion = ROOT }
							}
							holder_scope = {
								NOT = {
									character = ROOT
								}
							}
							holder_scope = {
								NOT = { same_society_as = ROOT }
							}
						}
					}
				}
				event_target:grandmaster = {
					character_event = { id = MNM.7023 }
				}
			}
			
			# Sacrifice someone (vanilla)
			20 = {
				trigger = {
					is_playable = yes
					
					society_member_of = twilights_hammer_cult
				}
				event_target:grandmaster = {
					character_event = { id = MNM.7024 }
				}
			}

			75 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}

			200 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}