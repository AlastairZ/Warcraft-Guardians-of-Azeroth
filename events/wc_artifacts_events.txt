#
#	1		-	49		- craft
#	50		-	99		- craft pings
#	100		-	149		- market
#	150		-	199		- market pings
#
#
#
#	900		-	999		- pings
#

namespace = WCAE

character_event = {
	id = WCAE.1 #Artifact Up
	desc = EVTDESC_WCAE_2

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { #Generic upgrades

		trigger = {
			event_target:improved_artifact = {
				OR = {
					# top hats
					artifact_type = top_hat
					artifact_type = top_hat_2
					artifact_type = top_hat_3
					# daggers
					artifact_type = dagger_1
					artifact_type = dagger_2
					artifact_type = dagger_3
					artifact_type = dagger_4
					# rings
					artifact_type = ring_2_diplomacy
					artifact_type = ring_3_diplomacy
					artifact_type = ring_4_diplomacy
					artifact_type = ring_2_martial
					artifact_type = ring_3_martial
					artifact_type = ring_4_martial
					artifact_type = ring_2_stewardship
					artifact_type = ring_3_stewardship
					artifact_type = ring_4_stewardship
					artifact_type = ring_2_intrigue
					artifact_type = ring_3_intrigue
					artifact_type = ring_4_intrigue
					artifact_type = ring_2_learning
					artifact_type = ring_3_learning
					artifact_type = ring_4_learning
					# amulets
					artifact_type = amulet_2_diplomacy
					artifact_type = amulet_3_diplomacy
					artifact_type = amulet_4_diplomacy
					artifact_type = amulet_2_martial
					artifact_type = amulet_3_martial
					artifact_type = amulet_4_martial
					artifact_type = amulet_2_stewardship
					artifact_type = amulet_3_stewardship
					artifact_type = amulet_4_stewardship
					artifact_type = amulet_2_intrigue
					artifact_type = amulet_3_intrigue
					artifact_type = amulet_4_intrigue
					artifact_type = amulet_2_learning
					artifact_type = amulet_3_learning
					artifact_type = amulet_4_learning
					# crowns
					artifact_type = crown_1
					artifact_type = crown_2
					artifact_type = crown_3
					# cloaks
					artifact_type = cloak_1
				}
			}
		}

		artifact_random_up_effect = yes

		name = {
			text = EVTOPTA_WCAE_4
			trigger = {
				event_target:improved_artifact = {
					OR = {
						artifact_type = top_hat
						artifact_type = top_hat_2
						artifact_type = top_hat_3
					}
				}
			}
		}

		name = {
			text = EVTOPTA_WCAE_8
			trigger = {
				event_target:improved_artifact = {
					artifact_type = top_hat_3
				}
			}
		}

		name = {
			text = EVTOPTA_WCAE_5
			trigger = {
				event_target:improved_artifact = {
					OR = {
						artifact_type = dagger_1
						artifact_type = dagger_2
						artifact_type = dagger_3
						artifact_type = dagger_4
					}
				}
			}	
		}

		name = {
			text = EVTOPTA_WCAE_6
			trigger = {
				event_target:improved_artifact = {
					OR = {
						artifact_type = cloak_1
						artifact_type = crown_1
						artifact_type = crown_2
						artifact_type = crown_3
						artifact_type = ring_2_diplomacy
						artifact_type = ring_3_diplomacy
						artifact_type = ring_4_diplomacy
						artifact_type = ring_2_martial
						artifact_type = ring_3_martial
						artifact_type = ring_4_martial
						artifact_type = ring_2_stewardship
						artifact_type = ring_3_stewardship
						artifact_type = ring_4_stewardship
						artifact_type = ring_2_intrigue
						artifact_type = ring_3_intrigue
						artifact_type = ring_4_intrigue
						artifact_type = ring_2_learning
						artifact_type = ring_3_learning
						artifact_type = ring_4_learning
						artifact_type = amulet_2_diplomacy
						artifact_type = amulet_3_diplomacy
						artifact_type = amulet_4_diplomacy
						artifact_type = amulet_2_martial
						artifact_type = amulet_3_martial
						artifact_type = amulet_4_martial
						artifact_type = amulet_2_stewardship
						artifact_type = amulet_3_stewardship
						artifact_type = amulet_4_stewardship
						artifact_type = amulet_2_intrigue
						artifact_type = amulet_3_intrigue
						artifact_type = amulet_4_intrigue
						artifact_type = amulet_2_learning
						artifact_type = amulet_3_learning
						artifact_type = amulet_4_learning
					}
				}
			}
		}

	}

	option = { # specials

		trigger = {
			OR = {
				AND = {
					event_target:improved_artifact = {
						artifact_type = top_hat
					}
					OR = {
						culture = pirate_culture
						culture = blackwater
					}
				}
				event_target:improved_artifact = { artifact_type = cloak_blue	}
				event_target:improved_artifact = { artifact_type = cloak_red	}
			}
		}

		event_target:improved_artifact = {
			set_artifact_flag = up_to_pirate_hat
		}

		custom_tooltip = { text = special_option_artifact_improve_tt }
		artifact_random_up_effect = yes

		name = {
			text = EVTOPTA_WCAE_3
			trigger = { event_target:improved_artifact = { artifact_type = top_hat } }
		}
		
		name = {
			text = EVTOPTA_WCAE_7
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = cloak_blue	}
					event_target:improved_artifact = { artifact_type = cloak_red	}
				}
			}
		}
	}

	option = { # paint blue

		trigger = {
			OR = {
				AND = {
					event_target:improved_artifact = {
						artifact_type = pirate_admiral_hat
					}
					OR = {
						culture = pirate_culture
						culture = blackwater
					}
				}
				event_target:improved_artifact = { artifact_type = ring_1	}
				event_target:improved_artifact = { artifact_type = amulet_1	}
				event_target:improved_artifact = { artifact_type = cloak_2	}
			}
		}

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_blue
		}
		
		artifact_random_up_effect = yes

		tooltip_info = diplomacy
		name = {
			text = EVTOPTA_WCAE_blue
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = pirate_admiral_hat	}
					event_target:improved_artifact = { artifact_type = cloak_2				}
				}
			}
		}

		name = {
			text = EVTOPTA_WCAE_blue_stone
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = ring_1	}
					event_target:improved_artifact = { artifact_type = amulet_1	}
				}
			}
		}
	}
	
	option = { # paint red

		trigger = {
			OR = {
				AND = {
					event_target:improved_artifact = {
						artifact_type = pirate_admiral_hat
					}
					culture = pirate_culture
				}
				event_target:improved_artifact = { artifact_type = ring_1	}
				event_target:improved_artifact = { artifact_type = amulet_1	}
				event_target:improved_artifact = { artifact_type = cloak_2	}
			}
		}

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_red
		}
		
		artifact_random_up_effect = yes

		tooltip_info = martial
		name = {
			text = EVTOPTA_WCAE_red
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = pirate_admiral_hat	}
					event_target:improved_artifact = { artifact_type = cloak_2				}
				}
			}
		}

		name = {
			text = EVTOPTA_WCAE_red_stone
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = ring_1	}
					event_target:improved_artifact = { artifact_type = amulet_1	}
				}
			}
		}
	}
	
	option = { # paint green

		trigger = {
			OR = {
				AND = {
					event_target:improved_artifact = {
						artifact_type = pirate_admiral_hat
					}
					culture = blackwater
				}
				event_target:improved_artifact = { artifact_type = ring_1	}
				event_target:improved_artifact = { artifact_type = amulet_1	}
				event_target:improved_artifact = { artifact_type = cloak_2	}
			}
		}

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_green
		}
		
		artifact_random_up_effect = yes

		tooltip_info = stewardship
		name = {
			text = EVTOPTA_WCAE_green
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = pirate_admiral_hat	}
					event_target:improved_artifact = { artifact_type = cloak_2				}
				}
			}
		}

		name = {
			text = EVTOPTA_WCAE_green_stone
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = ring_1	}
					event_target:improved_artifact = { artifact_type = amulet_1	}
				}
			}
		}
	}
	
	option = { #PRDX WHY
		trigger = {
			event_target:improved_artifact = {
				has_flag = four_or_more_up_choices
			}
		}
		name = EVTOPTA_WCMEME_back

		character_event = { id = WCAE.2 }
	}

	option = { #Exit

		name = EVT_OPTD_MNM_9310
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
		}

		prestige = -10

		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = improved_artifact_
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_

		ai_chance = {
			factor = 0
		}
	}
}

#Only 4 max option, so there additionals
character_event = {
	id = WCAE.2

	desc = EVTDESC_WCAE_2

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # paint violet

		trigger = {
			OR = {
				event_target:improved_artifact = { artifact_type = ring_1	}
				event_target:improved_artifact = { artifact_type = amulet_1	}
				event_target:improved_artifact = { artifact_type = cloak_2	}
			}
		}

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_violet
		}

		artifact_random_up_effect = yes

		tooltip_info = intrigue
		name = {
			text = EVTOPTA_WCAE_violet
			trigger = {
				event_target:improved_artifact = { artifact_type = cloak_2 }
			}
		}
		
		name = {
			text = EVTOPTA_WCAE_violet_stone
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = ring_1	}
					event_target:improved_artifact = { artifact_type = amulet_1	}
				}
			}
		}
	}
	
	option = { # paint white

		trigger = {
			OR = {
				event_target:improved_artifact = { artifact_type = ring_1	}
				event_target:improved_artifact = { artifact_type = amulet_1	}
				event_target:improved_artifact = { artifact_type = cloak_2	}
			}
		}

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_white
		}

		artifact_random_up_effect = yes

		tooltip_info = learning
		name = {
			text = EVTOPTA_WCAE_white
			trigger = {
				event_target:improved_artifact = { artifact_type = cloak_2 }
			}
		}

		name = {
			text = EVTOPTA_WCAE_white_stone
			trigger = {
				OR = {
					event_target:improved_artifact = { artifact_type = ring_1	}
					event_target:improved_artifact = { artifact_type = amulet_1	}
				}
			}
		}
	}
	
	# option = { # more than 4 variants generic upgrades ### OBSOLETE ###

		# trigger = {
			# event_target:improved_artifact = {
				# OR = {
					# artifact_type = ring_1 # ring_1 to ring_2 to ring_3
					# artifact_type = ring_2
				# }
			# }
		# }

		# artifact_random_up_effect = yes
		
		# name = EVTOPTA_WCAE_6
	# }
	
	option = { # Back
		name = EVTOPTA_WCMEME_back

		character_event = { id = WCAE.1 }

		ai_chance = {
			factor = 0
		}
	}
	
	option = { # Exit

		name = EVT_OPTD_MNM_9310
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
		}

		prestige = -10

		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = improved_artifact_
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_

		ai_chance = {
			factor = 0
		}
	}
	
}

#Results
character_event = { # success
	id = WCAE.3
	desc = EVTDESC_WCAE_7

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	immediate = {

		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = pirate_admiral_hat
					OR = {
						has_flag = paint_it_blue
						has_flag = paint_it_red
						has_flag = paint_it_green
					}
				}
			}
			event_target:improved_artifact = { # Paint Pirate Hat
				trigger_switch = {
					on_trigger = has_flag
					paint_it_blue 	= { artifact_owner = { add_artifact = pirate_admiral_hat_blue } }
					paint_it_red 	= { artifact_owner = { add_artifact = pirate_admiral_hat_red } }
					paint_it_green 	= { artifact_owner = { add_artifact = pirate_admiral_hat_green } }
				}
			}
		}

		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = ring_1
					OR = {
						has_flag = paint_it_blue
						has_flag = paint_it_red
						has_flag = paint_it_green
						has_flag = paint_it_violet
						has_flag = paint_it_white
					}
				}
			}
			event_target:improved_artifact = { # Paint Ring
				trigger_switch = {
					on_trigger = has_flag
					paint_it_blue 	= { artifact_owner = { add_artifact = ring_2_diplomacy		} }
					paint_it_red 	= { artifact_owner = { add_artifact = ring_2_martial		} }
					paint_it_green 	= { artifact_owner = { add_artifact = ring_2_stewardship	} }
					paint_it_violet = { artifact_owner = { add_artifact = ring_2_intrigue		} }
					paint_it_white	= { artifact_owner = { add_artifact = ring_2_learning		} }
				}
			}
		}
		
		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = amulet_1
					OR = {
						has_flag = paint_it_blue
						has_flag = paint_it_red
						has_flag = paint_it_green
						has_flag = paint_it_violet
						has_flag = paint_it_white
					}
				}
			}
			event_target:improved_artifact = { # Paint Amulet
				trigger_switch = {
					on_trigger = has_flag
					paint_it_blue 	= { artifact_owner = { add_artifact = amulet_2_diplomacy	} }
					paint_it_red 	= { artifact_owner = { add_artifact = amulet_2_martial		} }
					paint_it_green 	= { artifact_owner = { add_artifact = amulet_2_stewardship	} }
					paint_it_violet = { artifact_owner = { add_artifact = amulet_2_intrigue		} }
					paint_it_white	= { artifact_owner = { add_artifact = amulet_2_learning		} }
				}
			}
		}
		
		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = cloak_2
					OR = {
						has_flag = paint_it_blue
						has_flag = paint_it_red
						has_flag = paint_it_green
						has_flag = paint_it_violet
						has_flag = paint_it_white
					}
				}
			}
			event_target:improved_artifact = { # Paint Cloak
				trigger_switch = {
					on_trigger = has_flag
					paint_it_blue 	= { artifact_owner = { add_artifact = cloak_blue	} }
					paint_it_red 	= { artifact_owner = { add_artifact = cloak_red		} }
					paint_it_green 	= { artifact_owner = { add_artifact = cloak_green	} }
					paint_it_violet = { artifact_owner = { add_artifact = cloak_violet	} }
					paint_it_white	= { artifact_owner = { add_artifact = cloak_white	} }
				}
			}
		}
		
		if = {
			limit = {
				event_target:improved_artifact = {
					has_flag = up_to_pirate_hat
					OR = {
						artifact_type = top_hat
						artifact_type = cloak_blue
						artifact_type = cloak_red
					}
				}
			}

			event_target:improved_artifact = { # Specials
				trigger_switch = {
					on_trigger = artifact_type
					top_hat 			= { artifact_owner = { add_artifact = pirate_admiral_hat	} }
					cloak_blue 			= { artifact_owner = { add_artifact = cloak_alliance		} }
					cloak_red 			= { artifact_owner = { add_artifact = cloak_horde			} }
				}
			}
		}

		if = {
			limit = {
				NOT = {
					event_target:improved_artifact = {
						OR = {
							has_flag = up_to_pirate_hat
							has_flag = paint_it_blue
							has_flag = paint_it_red
							has_flag = paint_it_green
							has_flag = paint_it_violet
							has_flag = paint_it_white
						}
					}
				}
			}

			event_target:improved_artifact = { # Generic upgrades
				trigger_switch = {
					on_trigger = artifact_type
					crown_3 				= { artifact_owner = { add_artifact = crown_4	 			} }
					crown_2 				= { artifact_owner = { add_artifact = crown_3	 			} }
					crown_1 				= { artifact_owner = { add_artifact = crown_2				} }
					top_hat_3 				= { artifact_owner = { add_artifact = top_hat_4 			} }
					top_hat_2 				= { artifact_owner = { add_artifact = top_hat_3 			} }
					top_hat 				= { artifact_owner = { add_artifact = top_hat_2				} }
					dagger_4				= { artifact_owner = { add_artifact = dagger_5				} }
					dagger_3				= { artifact_owner = { add_artifact = dagger_4				} }
					dagger_2				= { artifact_owner = { add_artifact = dagger_3				} }				
					dagger_1				= { artifact_owner = { add_artifact = dagger_2				} }
					ring_2_diplomacy		= { artifact_owner = { add_artifact = ring_3_diplomacy		} }
					ring_3_diplomacy		= { artifact_owner = { add_artifact = ring_4_diplomacy		} }
					ring_4_diplomacy		= { artifact_owner = { add_artifact = ring_5_diplomacy		} }
					ring_2_martial			= { artifact_owner = { add_artifact = ring_3_martial		} }
					ring_3_martial			= { artifact_owner = { add_artifact = ring_4_martial		} }
					ring_4_martial			= { artifact_owner = { add_artifact = ring_5_martial		} }
					ring_2_stewardship		= { artifact_owner = { add_artifact = ring_3_stewardship	} }
					ring_3_stewardship		= { artifact_owner = { add_artifact = ring_4_stewardship	} }
					ring_4_stewardship		= { artifact_owner = { add_artifact = ring_5_stewardship	} }
					ring_2_intrigue			= { artifact_owner = { add_artifact = ring_3_intrigue		} }
					ring_3_intrigue			= { artifact_owner = { add_artifact = ring_4_intrigue		} }
					ring_4_intrigue			= { artifact_owner = { add_artifact = ring_5_intrigue		} }
					ring_2_learning			= { artifact_owner = { add_artifact = ring_3_learning		} }
					ring_3_learning			= { artifact_owner = { add_artifact = ring_4_learning		} }
					ring_4_learning			= { artifact_owner = { add_artifact = ring_5_learning		} }
					amulet_2_diplomacy		= { artifact_owner = { add_artifact = amulet_3_diplomacy	} }
					amulet_3_diplomacy		= { artifact_owner = { add_artifact = amulet_4_diplomacy	} }
					amulet_4_diplomacy		= { artifact_owner = { add_artifact = amulet_5_diplomacy	} }
					amulet_2_martial		= { artifact_owner = { add_artifact = amulet_3_martial		} }
					amulet_3_martial		= { artifact_owner = { add_artifact = amulet_4_martial		} }
					amulet_4_martial		= { artifact_owner = { add_artifact = amulet_5_martial		} }
					amulet_2_stewardship	= { artifact_owner = { add_artifact = amulet_3_stewardship	} }
					amulet_3_stewardship	= { artifact_owner = { add_artifact = amulet_4_stewardship	} }
					amulet_4_stewardship	= { artifact_owner = { add_artifact = amulet_5_stewardship	} }
					amulet_2_intrigue		= { artifact_owner = { add_artifact = amulet_3_intrigue		} }
					amulet_3_intrigue		= { artifact_owner = { add_artifact = amulet_4_intrigue		} }
					amulet_4_intrigue		= { artifact_owner = { add_artifact = amulet_5_intrigue		} }
					amulet_2_learning		= { artifact_owner = { add_artifact = amulet_3_learning		} }
					amulet_3_learning		= { artifact_owner = { add_artifact = amulet_4_learning		} }
					amulet_4_learning		= { artifact_owner = { add_artifact = amulet_5_learning		} }
					cloak_1					= { artifact_owner = { add_artifact = cloak_2				} }
				}
			}
		}

		new_artifact = {
			copy_artifact_history = event_target:improved_artifact
			set_artifact_original_owner = ROOT
		}
		event_target:improved_artifact = {
			clr_artifact_flag = up_to_pirate_hat
			clear_flags_with_prefix = paint_it_
			clr_artifact_flag = improved_artifact
			clear_event_target = improved_artifact
			destroy_artifact = yes
		}

	}

	after = {
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = improved_artifact_
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}

	option = {
		name = EVTOPTA_WCMEME_excellent
		
		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = 25 } }
				improved_artifact_2 = { ROOT = { prestige = 50 } }				
				improved_artifact_3 = { ROOT = { prestige = 100 } }
				improved_artifact_4 = { ROOT = { prestige = 250 } }
			}
		}
	}
}

character_event = { # minor failure
	id = WCAE.4
	desc = EVTDESC_WCAE_5

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	immediate = {
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
		}
	}

	after = {
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = improved_artifact_
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}

	option = {
		name = EVTOPTA_WCMEME_baka
		
		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = -25		} }
				improved_artifact_2 = { ROOT = { prestige = -50		} }				
				improved_artifact_3 = { ROOT = { prestige = -100	} }
				improved_artifact_4 = { ROOT = { prestige = -250	} }
			}
		}
	}
	
	option = {
		name = EVTOPTA_WCMEME_punishment

		trigger = {
			OR = {
				trait =	cruel
				trait = greedy
				trait = wroth
				trait =	impaler
				has_character_modifier = the_cruel
			}
		}

		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { 					piety = -25	} }
				improved_artifact_2 = { ROOT = { prestige = -25		piety = -25	} }				
				improved_artifact_3 = { ROOT = { prestige = -50		piety = -25	} }
				improved_artifact_4 = { ROOT = { prestige = -125	piety = -25	} }
			}
		}

		set_character_flag = artifact_up_minor_failure
		character_event = { id = WCAE.900 }
	}

	option = {
		name = EVTOPTA_WCMEME_too_kind

		trigger = {
			OR = {
				trait =	kind
				trait =	charitable
				has_character_modifier = the_kind
			}
		}
		
		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = -25		piety = 12.5 } }
				improved_artifact_2 = { ROOT = { prestige = -50		piety = 25	} }				
				improved_artifact_3 = { ROOT = { prestige = -100	piety = 50	} }
				improved_artifact_4 = { ROOT = { prestige = -250	piety = 125	} }
			}
		}

		set_character_flag = artifact_up_minor_failure
		character_event = { id = WCAE.901 }
	}
}

character_event = { # failure
	id = WCAE.5
	desc = EVTDESC_WCAE_6

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	immediate = {
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			set_description = artifact_damaged_not_improved_desc_rename
		}
		
	}

	after = {
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = improved_artifact_
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}

	option = {
		name = EVTOPTA_WCMEME_baka
		
		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = -50		} }
				improved_artifact_2 = { ROOT = { prestige = -100	} }				
				improved_artifact_3 = { ROOT = { prestige = -250	} }
				improved_artifact_4 = { ROOT = { prestige = -500	} }
			}
		}
	}

	option = {
		name = EVTOPTA_WCMEME_punishment

		trigger = {
			OR = {
				trait =	cruel
				trait = greedy
				trait = wroth
				trait =	impaler
				has_character_modifier = the_cruel
			}
		}

		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = -25		piety = -25 } }
				improved_artifact_2 = { ROOT = { prestige = -50		piety = -25	} }				
				improved_artifact_3 = { ROOT = { prestige = -125	piety = -25	} }
				improved_artifact_4 = { ROOT = { prestige = -250	piety = -25	} }
			}
		}
		
		set_character_flag = artifact_up_failure
		character_event = { id = WCAE.900 }
	}

	option = {
		name = EVTOPTA_WCMEME_too_kind

		trigger = {
			OR = {
				trait =	kind
				trait =	charitable
				has_character_modifier = the_kind
			}
		}
		
		set_character_flag = artifact_up_failure
		character_event = { id = WCAE.901 }

		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = -50		piety = 25 } }
				improved_artifact_2 = { ROOT = { prestige = -100	piety = 50	} }				
				improved_artifact_3 = { ROOT = { prestige = -250	piety = 125	} }
				improved_artifact_4 = { ROOT = { prestige = -500	piety = 250	} }
			}
		}
	}
}

character_event = { # critical failure
	id = WCAE.6
	desc = EVTDESC_WCAE_4_1
	desc = EVTDESC_WCAE_4_2

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	immediate = {
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
			destroy_artifact = yes
		}
	}

	after = {
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = improved_artifact_
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}

	option = {
		name = EVTOPTA_WCMEME_less_good_man
		
		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				improved_artifact_1 = { ROOT = { prestige = -100 } }
				improved_artifact_2 = { ROOT = { prestige = -250 } }				
				improved_artifact_3 = { ROOT = { prestige = -500 } }
				improved_artifact_4 = { ROOT = { prestige = -1000 } }
			}
		}
	}
}


# Market Results

character_event = { # success
	id = WCAE.100
	desc = EVTDESC_WCAE_8

	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	after = {
		set_variable = { which = artifact_market_cost_variable value = 0 }
	}

	option = { # Ok
		name = EVTOPTA_WCMEME_ok
		
		wealth = artifact_market_cost_variable
		
		if = {
			limit = {
				has_character_flag = bought_artifact_is_fake
			}
			character_event = { id = WCAE.102 days = 240 random = 240 }
		}
		else_if = {
			limit = {
				has_character_flag = bought_artifact_difficult_to_find
			}
			character_event = { id = WCAE.103 days = 120 random = 60 }
		}
		else = {
			character_event = { id = WCAE.103 days = 240 random = 120 }
		}
	}
	option = { # Nope
		name = EVT_OPTD_MNM_9310
		prestige = -5
		
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}
}

character_event = { # failure
	id = WCAE.101
	desc = EVTDESC_WCAE_9_1
	desc = EVTDESC_WCAE_9_2

	picture = GFX_evt_market_hf
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WCMEME_less_good_man

		prestige = -25
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}
}

character_event = { # critical failure
	id = WCAE.102
	desc = EVTDESC_WCAE_9_1

	picture = GFX_evt_market_hf
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WCMEME_less_good_man

		prestige = -50
		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}
}

character_event = { # craft done
	id = WCAE.103
	desc = EVTDESC_WCAE_

	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WCMEME_ok

		ROOT = {
			show_scope_change = no
			trigger_switch = {
				on_trigger = has_flag
				bought_artifact_top_hat			= {	add_artifact = top_hat	}
				bought_artifact_rogue_dagger	= {	add_artifact = dagger_1	}				
				bought_artifact_copper_ring		= {	add_artifact = ring_1	}
				bought_artifact_amulet			= {	add_artifact = amulet_1	}
				bought_artifact_ruler_crown		= {	add_artifact = crown_1	}
				bought_artifact_cloak			= {	add_artifact = cloak_1	}
			}
		}

		clr_character_flag = bought_thing_recently
		clear_flags_with_prefix = bought_from_
		clear_flags_with_prefix = bought_artifact_
	}
}

# Market Pings

character_event = { # Rly wanna?
	id = WCAE.150
	desc = EVTDESC_WCAE_10

	picture = GFX_evt_rider_adventure
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	hide_from = yes
	hide_new = yes

	immediate = {
		hidden_effect = {
			if = {
				limit = { stewardship = 12 }
				create_artifact_craftsman_effect = yes
				new_character = { save_event_target_as = target_local_candidate_craftsman }
			}
			else = {
				random_courtier_or_vassal = {
					limit = { char_can_buy_artifacts_no_flag_trigger = yes }
					preferred_limit = { has_job_title = job_treasurer }
					preferred_limit = { stewardship = 20 }
					preferred_limit = { stewardship = 16 }
					preferred_limit = { stewardship = 12 }
					save_event_target_as = target_my_little_artifacts_finding_slave_candidate
				}
			}
			if = {
				limit = {
					any_realm_wonder_upgrade = {
						limit = {
							has_wonder_upgrade = upgrade_armory
							is_active = yes
						}
					}
				}
				create_artifact_craftsman_effect = yes
				new_character = { save_event_target_as = target_armory_candidate_craftsman }
			}
		}
	}

	after = {
		hidden_effect = {
			if = {
				limit = { has_character_flag = hired_local_craftsman_flag }
				clr_character_flag = hired_local_craftsman_flag
				event_target:target_armory_candidate_craftsman = { leave_court_and_die_effect = yes }
			}
			else_if = {
				limit = { has_character_flag = hired_armory_craftsman_flag }
				clr_character_flag = hired_armory_craftsman_flag
				event_target:target_local_candidate_craftsman = { leave_court_and_die_effect = yes }
			}
			else = {
				event_target:target_armory_candidate_craftsman = { leave_court_and_die_effect = yes }
				event_target:target_local_candidate_craftsman = { leave_court_and_die_effect = yes }
			}
		}
	}

	option = { # I know local one
		name = EVTOPTA_WCAE_01
		tooltip_info = stewardship

		trigger = {
			stewardship = 12
			char_can_buy_artifacts_no_flag_trigger = yes
		}

		set_character_flag = hired_local_craftsman_flag
		event_target:target_local_candidate_craftsman = {
			show_scope_change = no
			move_character = ROOT
		}

		character_event = { id = WCAE.100 days = 7 random = 7 }
	}

	option = { # Send сourtier
		name = EVTOPTA_WCAE_02

		trigger = {
			stewardship < 12
			char_can_buy_artifacts_no_flag_trigger = yes
			
			NOT = {
				any_realm_wonder_upgrade = {
					limit = {
						has_wonder_upgrade = upgrade_armory
						is_active = yes
					}
					always = yes
				}
			}
		}

		random_buy_artifact_effect = yes
	}

	option = { # Send some servants
		name = EVTOPTA_WCAE_03

		trigger = {
			stewardship < 12
			char_can_buy_artifacts_no_flag_trigger = yes
			
			NOT = {
				any_realm_wonder_upgrade = {
					limit = {
						has_wonder_upgrade = upgrade_armory
						is_active = yes
					}
					always = yes
				}
			}
		}

		wealth = -100

		random_buy_artifact_effect = yes
	}

	option = { # Do it yourself
		name = EVTOPTA_WCAE_04

		trigger = {
			intrigue < 12
			NOT = { trait = slothful	}
			NOT = { trait = craven		}
			NOT = {	trait = shy			}
			NOT = { trait = proud		}
			char_can_buy_artifacts_no_flag_trigger = yes
		}

		if = {
			limit = { tier = emperor }
			prestige = -250
		}
		else_if = {
			limit = { tier = king }
			prestige = -100
		}
		else_if = {
			limit = { tier = duke }
			prestige = -50
		}
		else_if = {
			limit = { tier = count }
			prestige = -25
		}
		else = {
			prestige = -10
		}

		random = {
			chance = 10

			add_trait = diligent
		}

		character_event = { id = WCAE.100 days = 14 random = 14 }
	}

	option = { # Do it yourself, but incognito
		name = EVTOPTA_WCAE_05
		tooltip_info = intrigue

		trigger = {
			intrigue = 12
			NOT = { trait = slothful	}
			NOT = { trait = craven		}
			NOT = {	trait = shy			}
			NOT = { trait = proud		}
			char_can_buy_artifacts_no_flag_trigger = yes
		}

		random = {
			chance = 25

			add_trait = diligent
		}

		character_event = { id = WCAE.100 days = 28 random = 14 }
	}
	
	option = { # I know one in the armory
		name = EVTOPTA_WCAE_06
		tooltip_info = EVTOPTC_MNM_9115_TT

		trigger = {
			char_can_buy_artifacts_no_flag_trigger = yes
			#any_realm_wonder = {
			#	limit = {
			#		has_wonder_upgrade = upgrade_armory
			#		is_active = yes
			#	}
			#	#always = yes
			#}
		}

		set_character_flag = hired_armory_craftsman_flag
		event_target:target_local_candidate_craftsman = { show_portrait = yes }

		character_event = { id = WCAE.100 days = 14 random = 7 }
	}

	option = { # Nope
		name = EVT_OPTD_MNM_9310

		hidden_effect = {
			set_variable = { which = artifact_market_cost_variable value = 0 }
			clr_character_flag = bought_thing_recently
			clear_flags_with_prefix = bought_from_
			clear_flags_with_prefix = bought_artifact_
		}
	}
}

# Pings

character_event = { # Cruel ping
	id = WCAE.900
	desc = EVTOPTA_WCMEME_pingchanged

	picture = GFX_evt_bloody_knife_hf
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	after = {
		clr_character_flag = artifact_up_failure
		clr_character_flag = artifact_up_minor_failure
	}

	option = {
		name = EVTOPTA_WCMEME_ok

		random = {
			chance = 25
			modifier = {
				factor = 2.5
				has_flag = artifact_up_minor_failure
			}
			
			if = {
				limit = {
					has_character_modifier = the_kind
				}
				remove_character_modifier = the_kind
			}
			else_if = {
				limit = {
					trait = kind
				}
				remove_trait = kind
			}
			else_if = {
				limit = {
					trait = arbitrary
					has_flag = artifact_up_failure
				}
				remove_trait = arbitrary
			}
			else_if = {
				limit = {
					trait = charitable
					has_flag = artifact_up_minor_failure
				}
				remove_trait = charitable
			}
			else_if = {
				limit = {
					NOT = { trait = greedy }
					NOT = { trait = charitable }
					has_flag = artifact_up_minor_failure
				}
				add_trait = greedy
			}
			else_if = {
				limit = {
					NOT = { trait = just }
					NOT = { trait = arbitrary }
					has_flag = artifact_up_failure
				}
				add_trait = just
			}
			else_if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = cruel
			}
			else_if = {
				limit = {
					NOT = { has_character_modifier = the_cruel }
					has_flag = artifact_up_minor_failure
					trait = cruel
				}
				add_character_modifier = {
					name = the_cruel
					years = 3
				}
			}
			else = {
				if = {
					limit = { has_flag = artifact_up_failure }
					prestige = 25
				}
				else = {
					prestige = 10
				}
			}
		}
	}

	option = {
		name = EVTOPTA_WCMEME_weirdflexbutnotok

		random = {
			chance = 50
			if = {
				limit = {
					NOT = { trait = stressed }
				}
				add_trait = stressed
			}
			else_if = {
				limit = {
					NOT = { trait = depressed }
				}
				add_trait = depressed
			}
			else = {
				health = -0.25
			}
		}
	}
}

character_event = { # Kind ping
	id = WCAE.901
	desc = EVTOPTA_WCMEME_pingchanged

	picture = GFX_evt_fishing
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	after = {
		clr_character_flag = artifact_up_failure
		clr_character_flag = artifact_up_minor_failure
	}

	option = {
		name = EVTOPTA_WCMEME_ok

		random = {
			chance = 50
			modifier = {
				factor = 1.5
				has_flag = artifact_up_failure
			}

			if = {
				limit = {
					has_character_modifier = the_cruel
				}
				remove_character_modifier = the_cruel
			}
			else_if = {
				limit = {
					trait = cruel
				}
				remove_trait = cruel
			}
			else_if = {
				limit = {
					trait = greedy
				}
				remove_trait = greedy
			}
			else_if = {
				limit = {
					NOT = { trait = greedy }
					NOT = { trait = charitable }
				}
				add_trait = charitable
			}
			else_if = {
				limit = {
					trait = ambitious
				}
				remove_trait = ambitious
			}
			else_if = {
				limit = {
					NOT = { trait = ambitious }
					NOT = { trait = content }
				}
				add_trait = content
			}
			else_if = {
				limit = {
					trait = wroth
					has_flag = artifact_up_minor_failure
				}
				remove_trait = wroth
			}
			else_if = {
				limit = {
					NOT = { trait = patient }
					NOT = { trait = wroth }
					has_flag = artifact_up_minor_failure
				}
				add_trait = patient
			}
			else_if = {
				limit = {
					trait = just
					has_flag = artifact_up_failure
				}
				remove_trait = just
			}
			else_if = {
				limit = {
					NOT = { trait = cruel }
					NOT = { trait = kind }
					has_flag = artifact_up_failure
				}
				add_trait = kind
			}
			else_if = {
				limit = {
					NOT = { trait = just }
					NOT = { trait = arbitrary }
					has_flag = artifact_up_failure
				}
				add_trait = arbitrary
			}
			else_if = {
				limit = {
					NOT = { has_character_modifier = the_kind }
					trait = kind
				}
				add_character_modifier = {
					name = the_kind
					years = 3
				}
			}
			else = {
				if = {
					limit = { has_flag = artifact_up_failure }
					piety = 25
				}
				else = {
					piety = 10
				}
			}
		}
	}

	option = {
		name = EVTOPTA_WCMEME_weirdflexbutnotok

		random = {
			chance = 50
			if = {
				limit = {
					NOT = { trait = stressed }
				}
				add_trait = stressed
			}
			else_if = {
				limit = {
					NOT = { trait = depressed }
				}
				add_trait = depressed
			}
			else = {
				health = -0.25
			}
		}
	}
}