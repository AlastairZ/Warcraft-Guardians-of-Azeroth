namespace = WCAE

# Got Rare Pepe
character_event = {
	id = WCAE.1
	desc = EVTDESC_WCAE_1
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	
	option = {
		create_character = {
			random_traits = no
			name = "Mrglmargo-Mrglos"
			dynasty = none
			religion = ROOT
			race = murloc
			culture = ROOT
			female = no
			age = 26
			trait = creature_murloc # Murloc = frogs, innit?
			trait = skilled_tactician
			trait = trickster
			trait = flanker
			trait = quick
			trait = strong
			trait = fair
			trait = robust
			trait = groomed
			trait = socializer
			trait = homosexual #Chemicals in the water are turning frogs gay
			trait = lustful
			attributes = {
				martial = 8
			}
		}
		new_character = {
			if = {
				limit = {
					ROOT = {
						trait = creature_murloc
						trait = homosexual
						is_female = no
					}
				}
				add_lover = ROOT
			}
			if = {
				limit = {
					ROOT = {
						culture = pirate_culture
					}
				}
				add_trait = pirate
			}
			if = {
				limit = {
					ROOT = {
						religion_group = light_group
					}
				}
				add_trait = class_paladin_8 # Blue icon = rare
			}
			if = {
				limit = {
					ROOT = {
							religion_group = necromancy_group
					}
				}
				add_trait = class_death_knight_8 # Blue icon = rare
			}
			if = {
				limit = {
					ROOT = {
						NOT = {
							religion_group = light_group
							religion_group = necromancy_group
						}
					}
				}
				add_trait = class_warrior_8 # Blue icon = rare
			}
			add_friend = ROOT
			will_not_marry_effect = yes
		}
		name = EVTOPTA_WCAE_1
	}
}

character_event = {
	id = WCAE.2 #Artifact Up
	desc = EVTDESC_WCAE_2

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # top_hat to top_hat_2 to top_hat_3

		trigger = {
			event_target:improved_artifact = {
				OR = {
					artifact_type = top_hat
					artifact_type = top_hat_2
				}
			}
		}

		wealth = local_third_party_score

		random_list = {
			80 = { #success
				custom_tooltip = {
					text = artifact_up_success_tooltip
					character_event = { id = WCAE.3 }
				}
				artifact_up_success_score = yes
			}
			10 = { # minor failure
				custom_tooltip = {
					text = artifact_up_failure_minor_tooltip
					character_event = { id = WCAE.4 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #failure
				custom_tooltip = {
					text = artifact_up_failure_tooltip
					character_event = { id = WCAE.6 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #critical failure
				custom_tooltip = {
					text = artifact_up_critical_failure_tooltip
					character_event = { id = WCAE.5 }
				}
				artifact_up_critical_failure_score = yes
			}
		}

		name = EVTOPTA_WCAE_4

		#ai_chance = {
		#	factor = 0
		#	OR = {
		#		culture = pirate_culture
		#		culture = blackwater
		#	}
		#}
	}

	option = { # top_hat to pirate_hat

		trigger = {
			event_target:improved_artifact = {
				artifact_type = top_hat
			}
			OR = {
				culture = pirate_culture
				culture = blackwater
			}
		}

		wealth = local_third_party_score

		event_target:improved_artifact = {
			set_artifact_flag = up_to_pirate_hat
		}
		
		random_list = {
			80 = { #success
				custom_tooltip = {
					text = artifact_up_success_tooltip
					character_event = { id = WCAE.3 }
				}
				artifact_up_success_score = yes
			}
			10 = { # minor failure
				custom_tooltip = {
					text = artifact_up_failure_minor_tooltip
					character_event = { id = WCAE.4 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #failure
				custom_tooltip = {
					text = artifact_up_failure_tooltip
					character_event = { id = WCAE.6 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #critical failure
				custom_tooltip = {
					text = artifact_up_critical_failure_tooltip
					character_event = { id = WCAE.5 }
				}
				artifact_up_critical_failure_score = yes
			}
		}

		name = EVTOPTA_WCAE_3

		#ai_chance = {
		#	factor = 1
		#}
	}

	option = { # paint pirate_hat blue

		trigger = {
			event_target:improved_artifact = {
				artifact_type = pirate_admiral_hat
			}
			OR = {
				culture = pirate_culture
				culture = blackwater
			}
		}

		wealth = local_third_party_score

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_blue
		}
		
		random_list = {
			80 = { #success
				custom_tooltip = {
					text = artifact_up_success_tooltip
					character_event = { id = WCAE.3 }
				}
				artifact_up_success_score = yes
			}
			10 = { # minor failure
				custom_tooltip = {
					text = artifact_up_failure_minor_tooltip
					character_event = { id = WCAE.4 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #failure
				custom_tooltip = {
					text = artifact_up_failure_tooltip
					character_event = { id = WCAE.6 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #critical failure
				custom_tooltip = {
					text = artifact_up_critical_failure_tooltip
					character_event = { id = WCAE.5 }
				}
				artifact_up_critical_failure_score = yes
			}
		}

		name = EVTOPTA_WCAE_blue

		#ai_chance = {
		#	factor = 1
		#}
	}
	
	option = { # paint pirate_hat red

		trigger = {
			event_target:improved_artifact = {
				artifact_type = pirate_admiral_hat
			}
			culture = pirate_culture
		}

		wealth = local_third_party_score

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_red
		}
		
		random_list = {
			80 = { #success
				custom_tooltip = {
					text = artifact_up_success_tooltip
					character_event = { id = WCAE.3 }
				}
				artifact_up_success_score = yes
			}
			10 = { # minor failure
				custom_tooltip = {
					text = artifact_up_failure_minor_tooltip
					character_event = { id = WCAE.4 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #failure
				custom_tooltip = {
					text = artifact_up_failure_tooltip
					character_event = { id = WCAE.6 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #critical failure
				custom_tooltip = {
					text = artifact_up_critical_failure_tooltip
					character_event = { id = WCAE.5 }
				}
				artifact_up_critical_failure_score = yes
			}
		}

		name = EVTOPTA_WCAE_red

		#ai_chance = {
		#	factor = 1
		#}
	}
	
	option = { # paint pirate_hat green

		trigger = {
			event_target:improved_artifact = {
				OR = {
					artifact_type = pirate_admiral_hat
				}
			}
			culture = blackwater
		}

		wealth = local_third_party_score

		event_target:improved_artifact = {
			set_artifact_flag = paint_it_green
		}
		
		random_list = {
			80 = { #success
				custom_tooltip = {
					text = artifact_up_success_tooltip
					character_event = { id = WCAE.3 }
				}
				artifact_up_success_score = yes
			}
			10 = { # minor failure
				custom_tooltip = {
					text = artifact_up_failure_minor_tooltip
					character_event = { id = WCAE.4 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #failure
				custom_tooltip = {
					text = artifact_up_failure_tooltip
					character_event = { id = WCAE.6 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #critical failure
				custom_tooltip = {
					text = artifact_up_critical_failure_tooltip
					character_event = { id = WCAE.5 }
				}
				artifact_up_critical_failure_score = yes
			}
		}

		name = EVTOPTA_WCAE_green

		#ai_chance = {
		#	factor = 1
		#}
	}
	
	option = { # dagger_1 to dagger_2 to dagger_3 to dagger_4

		trigger = {
			event_target:improved_artifact = {
				OR = {
					artifact_type = dagger_1
					artifact_type = dagger_2
					artifact_type = dagger_3
				}
			}
		}

		wealth = local_third_party_score

		random_list = {
			80 = { #success
				custom_tooltip = {
					text = artifact_up_success_tooltip
					character_event = { id = WCAE.3 }
				}
				artifact_up_success_score = yes
			}
			10 = { # minor failure
				custom_tooltip = {
					text = artifact_up_failure_minor_tooltip
					character_event = { id = WCAE.4 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #failure
				custom_tooltip = {
					text = artifact_up_failure_tooltip
					character_event = { id = WCAE.6 }
				}
				artifact_up_failure_score = yes
			}
			5 = { #critical failure
				custom_tooltip = {
					text = artifact_up_critical_failure_tooltip
					character_event = { id = WCAE.5 }
				}
				artifact_up_critical_failure_score = yes
			}
		}

		name = EVTOPTA_WCAE_5

		#ai_chance = {
		#	factor = 0
		#	OR = {
		#		culture = pirate_culture
		#		culture = blackwater
		#	}
		#}
	}
	
	option = { #Exit

		name = EVT_OPTD_MNM_9310
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
		}

		clr_character_flag = improved_artifact_1
		clr_character_flag = improved_artifact_2
		clr_character_flag = improved_artifact_3

		ai_chance = {
			factor = 0
		}
	}
}

#Results
character_event = { #success
	id = WCAE.3
	desc = EVTDESC_WCAE_7

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	immediate = {
		if = { # Top hat
			limit = {
				event_target:improved_artifact = {
					artifact_type = top_hat
					NOT = { has_flag = up_to_pirate_hat }
				}
			}
			add_artifact = top_hat_2
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
		}
		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = top_hat
					has_flag = up_to_pirate_hat
				}
			}
			add_artifact = pirate_admiral_hat
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
			event_target:improved_artifact = {
				clr_artifact_flag = up_to_pirate_hat
			}
		}
		if = { # Top hat 2
			limit = {
				event_target:improved_artifact = {
					artifact_type = top_hat_2
				}
			}
			add_artifact = top_hat_3
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
		}
		if = { #Pirate Hat
			limit = {
				event_target:improved_artifact = {
					artifact_type = pirate_admiral_hat
					has_flag = paint_it_blue
				}
			}
			add_artifact = pirate_admiral_hat_blue
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
			event_target:improved_artifact = {
				clr_artifact_flag = paint_it_blue
			}
		}
		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = pirate_admiral_hat
					has_flag = paint_it_red
				}
			}
			add_artifact = pirate_admiral_hat_red
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
			event_target:improved_artifact = {
				clr_artifact_flag = paint_it_red
			}
		}
		if = {
			limit = {
				event_target:improved_artifact = {
					artifact_type = pirate_admiral_hat
					has_flag = paint_it_green
				}
			}
			add_artifact = pirate_admiral_hat_green
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
			event_target:improved_artifact = {
				clr_artifact_flag = paint_it_green
			}
		}
		if = { # dagger_1
			limit = {
				event_target:improved_artifact = {
					artifact_type = dagger_1
				}
			}
			add_artifact = dagger_2
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
		}
		if = { # dagger_2
			limit = {
				event_target:improved_artifact = {
					artifact_type = dagger_2
				}
			}
			add_artifact = dagger_3
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
		}
		if = { # dagger_3
			limit = {
				event_target:improved_artifact = {
					artifact_type = dagger_3
				}
			}
			add_artifact = dagger_4
			new_artifact = { copy_artifact_history = event_target:improved_artifact }
		}
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
			destroy_artifact = yes
		}
	}

	after = {
		clr_character_flag = improved_artifact_1
		clr_character_flag = improved_artifact_2
		clr_character_flag = improved_artifact_3
	}

	option = {
		name = EVTOPTA_WCMEME_excellent
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = 25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = 50
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = 100
			break = yes
		}
	}
}

character_event = { #minor failure
	id = WCAE.4
	desc = EVTDESC_WCAE_5

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	immediate = {
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
		}
	}

	after = {
		clr_character_flag = improved_artifact_1
		clr_character_flag = improved_artifact_2
		clr_character_flag = improved_artifact_3
	}

	option = {
		name = EVTOPTA_WCMEME_baka
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = -25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -50
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -100
			break = yes
		}
	}
	
	option = {
		name = EVTOPTA_WCMEME_punishment

		trigger = {
			OR = {
				trait =	cruel
				trait = greedy
				trait =	impaler
				has_character_modifier = the_cruel
			}
		}

		random = {
			chance = 50

			if = {
				limit = {
					has_character_modifier = the_cruel
				}
				remove_character_modifier = the_kind
			}
			else_if = {
				limit = {
					trait = kind
				}
				remove_trait = kind
			}
			else_if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = cruel
			}
			else_if = {
				limit = {
					NOT = { has_character_modifier = the_cruel }
					trait = cruel
				}
				add_character_modifier = {
					name = the_cruel
					years = 3
				}
			}
		}
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			piety = -25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -25
			piety = -25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -50
			piety = -25
			break = yes
		}
	}

	option = {
		name = EVTOPTA_WCMEME_too_kind

		trigger = {
			OR = {
				trait =	kind
				trait =	charitable
				has_character_modifier = the_kind
			}
		}

		random = {
			chance = 50

			if = {
				limit = {
					has_character_modifier = the_cruel
				}
				remove_character_modifier = the_cruel
			}
			else_if = {
				limit = {
					trait = cruel
				}
				remove_trait = cruel
			}
			else_if = {
				limit = {
					trait = greedy
				}
				remove_trait = greedy
			}
			else_if = {
				limit = {
					NOT = { trait = greedy }
					NOT = { trait = charitable }
				}
				add_trait = charitable
			}
			else_if = {
				limit = {
					NOT = { trait = cruel }
					NOT = { trait = kind }
				}
				add_trait = kind
			}
			else_if = {
				limit = {
					NOT = { has_character_modifier = the_kind }
					trait = kind
				}
				add_character_modifier = {
					name = the_kind
					years = 3
				}
			}
		}
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = -25
			piety = 10
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -50
			piety = 25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -100
			piety = 50
			break = yes
		}
	}
}

character_event = { #critical failure
	id = WCAE.5
	desc = EVTDESC_WCAE_4_1
	desc = EVTDESC_WCAE_4_2

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	immediate = {
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
			clr_artifact_flag = improved_artifact
			destroy_artifact = yes
		}
	}

	after = {
		clr_character_flag = improved_artifact_1
		clr_character_flag = improved_artifact_2
		clr_character_flag = improved_artifact_3
	}

	option = {
		name = EVTOPTA_WCMEME_less_good_man
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = -100
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -250
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -500
			break = yes
		}
	}

}

character_event = { # failure
	id = WCAE.6
	desc = EVTDESC_WCAE_6

	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	
	immediate = {
		event_target:improved_artifact = {
			clear_event_target = improved_artifact
		}
	}

	after = {
		clr_character_flag = improved_artifact_1
		clr_character_flag = improved_artifact_2
		clr_character_flag = improved_artifact_3
	}

	option = {
		name = EVTOPTA_WCMEME_baka
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = -50
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -100
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -250
			break = yes
		}
	}

	option = {
		name = EVTOPTA_WCMEME_punishment

		trigger = {
			OR = {
				trait =	cruel
				trait = greedy
				trait =	impaler
				has_character_modifier = the_cruel
			}
		}

		random = {
			chance = 25

			if = {
				limit = {
					has_character_modifier = the_cruel
				}
				remove_character_modifier = the_kind
			}
			else_if = {
				limit = {
					trait = kind
				}
				remove_trait = kind
			}
			else_if = {
				limit = {
					NOT = { trait = kind }
					NOT = { trait = cruel }
				}
				add_trait = cruel
			}
			else_if = {
				limit = {
					NOT = { has_character_modifier = the_cruel }
					trait = cruel
				}
				add_character_modifier = {
					name = the_cruel
					years = 3
				}
			}
		}
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = -25
			piety = -25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -50
			piety = -25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -125
			piety = -25
			break = yes
		}
	}

	option = {
		name = EVTOPTA_WCMEME_too_kind

		trigger = {
			OR = {
				trait =	kind
				trait =	charitable
				has_character_modifier = the_kind
			}
		}

		random = {
			chance = 75

			if = {
				limit = {
					has_character_modifier = the_cruel
				}
				remove_character_modifier = the_cruel
			}
			else_if = {
				limit = {
					trait = cruel
				}
				remove_trait = cruel
			}
			else_if = {
				limit = {
					trait = greedy
				}
				remove_trait = greedy
			}
			else_if = {
				limit = {
					NOT = { trait = greedy }
					NOT = { trait = charitable }
				}
				add_trait = charitable
			}
			else_if = {
				limit = {
					NOT = { trait = cruel }
					NOT = { trait = kind }
				}
				add_trait = kind
			}
			else_if = {
				limit = {
					NOT = { has_character_modifier = the_kind }
					trait = kind
				}
				add_character_modifier = {
					name = the_kind
					years = 3
				}
			}
		}
		if = {
			limit = {
				has_flag = improved_artifact_1
			}
			prestige = -50
			piety = 25
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_2
			}
			prestige = -100
			piety = 50
			break = yes
		}
		if = {
			limit = {
				has_flag = improved_artifact_3
			}
			prestige = -250
			piety = 125
			break = yes
		}
	}
}