namespace=WCCC
###MISSIONS###
#WCCC.200 is tombola
character_event = {
	id = WCCC.200

	is_triggered_only = yes
	hide_window = yes
	
	min_age = 16
	only_capable = yes
	prisoner = no
	is_in_society = yes

	trigger = {
		society_member_of = cenarion_circle
		is_society_grandmaster = no
		has_any_quest = no
		NOT = { is_inaccessible_trigger = yes }
		NOT = { has_character_modifier = quest_cooldown_timer }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				same_society_as = ROOT
			}
			save_event_target_as = cenarion_leader
		}

		random_list = {
			10 = { 
				set_character_flag = cenarion_circle_enter_emerald_dream
				modifier = { factor = 0 trait = in_emerald_dream }
			}
			10 = {
				modifier = { factor = 0 NOT = { has_dlc ="Way of Life" } }
				modifier = { factor = 0 has_focus = focus_theology }
				modifier = { factor = 0 is_playable = no } # Only playable characters get focuses
				set_character_flag = cenarion_circle_mission_theology
			}
			10 = {
				modifier = { factor = 0 is_landed = no }
				set_character_flag = cenarion_circle_mission_barrow_den
			}
			50 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			85 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
		event_target:cenarion_leader = { character_event = { id = WCCC.210 days = 7 random = 7 } }
	}
}

#Tombola Ping Event
character_event = {
	id = WCCC.210
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = {
			trigger_switch = {
				on_trigger = has_character_flag
				cenarion_circle_enter_emerald_dream = { clr_character_flag = cenarion_circle_enter_emerald_dream society_quest_event = { id = WCCC.211} }
				cenarion_circle_mission_theology = { clr_character_flag = cenarion_circle_mission_theology society_quest_event = { id = WCCC.212} }
				cenarion_circle_mission_barrow_den = { clr_character_flag = cenarion_circle_mission_theology society_quest_event = { id = WCCC.213} }
			}
		}
	}
}

#QUEST: Enter emerald dream
society_quest_event = {
	id = WCCC.211
	border = GFX_event_letter_frame_religion

	desc = {
		text = EVTDESC_WCCC.211
	}
	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = enter_emerald_dream
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}
#QUEST: Pick theology focus
society_quest_event = {
	id = WCCC.212
	border = GFX_event_letter_frame_religion

	desc = {
		text = EVTDESC_WCCC.212
	}
	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = mission_theology
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}
#QUEST: Build barrow den
society_quest_event = {
	id = WCCC.213
	border = GFX_event_letter_frame_religion

	desc = {
		text = EVTDESC_WCCC.213
	}
	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = mission_build_barrow_den
		character_event = { id = WCCC.230 days = 30 }
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}
character_event = {
	id = WCCC.230
	desc = EVTDESC_WCCC.230
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	
	option = {
		name = EVTOPTA_WCCC.230
		character_event = { id = WCCC.231 }
	}
}
character_event = {
	id = WCCC.231
	desc = EVTDESC_WCCC.231
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes


	option = {
		name = EVTOPTA_WCCC.231
		set_character_flag = barrow_den_small
		character_event = { id = WCCC.232 days = 60 }
	}
	option = {
		name = EVTOPTB_WCCC.231
		trigger = {
			OR = {
				ai = no
				wealth = 100
			}
		}
		set_character_flag = barrow_den_medium
		character_event = { id = WCCC.232 days = 60 }
	}
	option = {
		name = EVTOPTC_WCCC.231
		trigger = {
			OR = {
				ai = no
				wealth = 300
			}
		}
		set_character_flag = barrow_den_large
		character_event = { id = WCCC.232 days = 60 }
	}
	option = {
		name = EVTOPTD_WCCC.231
		trigger = { is_society_grandmaster = yes }
		set_character_flag = barrow_den_enormous
		character_event = { id = WCCC.232 days = 60 }
	}
}
character_event = {
	id = WCCC.232
	desc = EVTDESC_WCCC.232
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_WCCC.232
		trigger = {
			has_character_flag = barrow_den_small
		}
	}
	option = {
		name = EVTOPTB_WCCC.232
		trigger = {
			is_society_grandmaster = no
		}
		if = {
			limit = {
				has_character_flag = barrow_den_medium
			}
			wealth = -100
			character_event = { id = WCCC.233 days = 360 random = 360 }
		}
		if = {
			limit = {
				has_character_flag = barrow_den_large
			}
			wealth = -300
			character_event = { id = WCCC.233 days = 360 random = 360 }
		}
	}
	option = {
		name = EVTOPTC_WCCC.232
		trigger = {
			has_character_flag = barrow_den_medium
			piety = 100
			piety < 300
			is_society_grandmaster = no
		}
		piety = -100
		character_event = { id = WCCC.233 days = 360 random = 360 }
	}
	option = {
		name = EVTOPTC_WCCC.232
		trigger = {
			has_character_flag = barrow_den_large
			piety = 300
			is_society_grandmaster = no
		}
		piety = -300
		character_event = { id = WCCC.233 days = 360 random = 360 }
	}
	# option = {
		# name = EVTOPTD_WCCC.232
		# trigger = { is_society_grandmaster = yes }
		# cenarion_circle = { any_society_member = { letter_event = { id = WCCC.240 } } }
	# }
}
character_event = {
	id = WCCC.233
	desc = EVTDESC_WCCC.233
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_WCCC.233
		clr_quest = mission_build_barrow_den
		add_society_currency_medium_effect = yes
		if = {
			limit = {
				has_character_flag = barrow_den_small
			}
			add_character_modifier = barrow_den_small
			piety = 100
		}
		if = {
			limit = {
				has_character_flag = barrow_den_medium
			}
			add_character_modifier = barrow_den_medium
			piety = 200
		}
		if = {
			limit = {
				has_character_flag = barrow_den_large
			}
			add_character_modifier = barrow_den_large
			piety = 300
		}
	}
}
letter_event = {
	id = WCCC.240
	desc = EVTDESC_WCCC.240
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes

	
	option = {
		name = ACCEPT
		add_trait = travelling
		character_event = { id = WCCC.241 }
	}
	option = {
		name = DECLINE
	}
}
character_event = {
	id = WCCC.241
	desc = EVTDESC_WCCC.241
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	
	option = {
		name = EVTOPTA_WCCC.241
		character_event = { id = WCCC.242 days = 30 }
	}
}