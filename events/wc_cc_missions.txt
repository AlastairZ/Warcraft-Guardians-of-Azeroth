namespace=WCCC
###MISSIONS###
#WCCC.200 is tombola
character_event = {
	id = WCCC.200

	is_triggered_only = yes
	hide_window = yes
	
	min_age = 16
	only_capable = yes
	prisoner = no
	is_in_society = yes

	trigger = {
		society_member_of = cenarion_circle
		is_society_grandmaster = no
		has_any_quest = no
		NOT = { is_inaccessible_trigger = yes }
		NOT = { has_character_modifier = quest_cooldown_timer }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				same_society_as = ROOT
			}
			save_event_target_as = cenarion_leader
		}

		random_list = {
			10 = {
				modifier = { factor = 0 is_landed = no }
				modifier = { factor = 0 NOT = { any_demesne_province = { has_hospital = no } } }
				set_character_flag = cenarion_circle_mission_build_hospital
			}
			50 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			85 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
		event_target:cenarion_leader = { character_event = { id = WCCC.210 days = 7 random = 7 } }
	}
}

#Tombola Ping Event
character_event = {
	id = WCCC.210
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		FROM = {
			trigger_switch = {
				on_trigger = has_character_flag
				cenarion_circle_mission_build_hospital= { clr_character_flag = cenarion_circle_mission_build_hospital society_quest_event = { id = WCCC.214} }
			}
		}
	}
}

#QUEST: Build hospital
society_quest_event = {
	id = WCCC.214
	border = GFX_event_letter_frame_religion

	desc = {
		text = EVTDESC_WCCC.214
	}
	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = mission_build_hospital
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}

# on_hospital_construction_completed
# Hospital is done
character_event = {
	id = WCCC.220
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_quest = mission_build_hospital 
		NOT = { has_character_flag = cc_hospital_construction_ongoing }
	}
	
	immediate = {
		set_character_flag = cc_hospital_construction_ongoing 
		random_society_member = {
			limit = {
				same_society_as = ROOT
				is_society_grandmaster = yes
			}
			character_event = {
				id = WCCC.221
			}
		}
	}
}
# Ping event
character_event = {
	id = WCCC.221
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		FROM = {
			character_event = {
				id = WCCC.222
			}
		}
	}
}
# Quest completed
letter_event = {
	id = WCCC.222
	desc = EVTDESC_WCCC.222
	border = GFX_event_letter_frame_religion
	
	is_triggered_only = yes
	
	trigger = { has_quest = mission_build_hospital }
	
	option = {
		name = EVTOPTA_WCCC.222
		clr_quest = mission_build_hospital
		add_society_currency_tiny_effect = yes
	}
	after = {
		clr_character_flag = cc_hospital_construction_ongoing
	}
}