namespace = WCTFT

# Delayed event that corrupts Sunwell
province_event = {
	id = WCTFT.95
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		add_deathwell_effect = yes
	}
}

### Plaguelands Civil War ###
# Ping event
province_event = {
	id = WCTFT.99

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		start_date = 605.6.6
		NOT = { 
			has_global_flag = plaguelands_civil_war_ongoing
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
		}
	}

	immediate = {
		set_global_flag = plaguelands_civil_war_ongoing
		
		#Spawn event troops for Forsaken, Resistance and Insurgents - disabled for a while, plus they need adapting
		# c_60030 = {
			# spawn_unit = {
				# owner = THIS
				# province = 279
				# home = 279
				# troops = {
					# archers = { 900 900 }
					# light_infantry = { 1350 1350 }
					# heavy_infantry = { 1775 1775 }
					# light_cavalry = { 225 225 }
					# knights = { 335 335 }
				# }
				# cannot_inherit = no
				# attrition = 1.0
				# reinforces = yes
				# maintenance = no
			# }
		# }
		# c_42076 = {
			# spawn_unit = {
				# owner = THIS
				# province = 308
				# home = 308
				# troops = {
					# archers = { 1200 1200 }
					# light_infantry = { 1800 1800 }
					# heavy_infantry = { 2250 2250 }
					# light_cavalry = { 300 300 }
					# knights = { 450 450 }
				# }
				# cannot_inherit = no
				# attrition = 1.0
				# reinforces = yes
				# maintenance = no
			# }
		# }
		# c_430400 = {
			# spawn_unit = {
				# owner = THIS
				# province = 312
				# home = 312
				# troops = {
					# archers = { 600 600 }
					# light_infantry = { 900 900 }
					# heavy_infantry = { 1125 1125 }
					# light_cavalry = { 150 150 }
					# knights = { 225 225 }
				# }
				# cannot_inherit = no
				# attrition = 1.0
				# reinforces = yes
				# maintenance = no
			# }
		# }
		
		d_lordamere = {
			holder_scope = { narrative_event = { id = WCTFT.100 } }
		}
	}
}

# Notifies the world of the ongoing civil war, Garithos can choose his CB here
narrative_event = {
	id = WCTFT.100
	title = EVTTITLE_WCTFT_100
	desc = EVTDESC_WCTFT_100
	picture = GFX_evt_scourge_march
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes

	major = yes
	major_trigger = {
		ai = no
	}
	show_root = yes

	option = { #To the strongest!
		trigger = { character = ROOT }
		k_lordaeron = {
			if = {
				limit = { has_holder = yes }
				holder_scope = {
					set_character_flag = event_war_exception_flag
					reverse_unsafe_war = {
						target = ROOT
						casus_belli = invasion
						thirdparty_title = PREV
					}
				}
			}
		}
		prestige = 500
		piety = -250
		name = EVTOPTA_WCTFT_100
		ai_chance = {
			factor = 1
		}
	}

	option = { #To the rightful heir!
		trigger = { character = ROOT }
		k_lordaeron = {
			if = {
				limit = { has_holder = yes }
				holder_scope = {
					set_character_flag = event_war_exception_flag
					reverse_unsafe_war = {
						target = c_60004
						casus_belli = other_claim
						thirdparty = ROOT
						thirdparty_title = PREV
					}
				}
			}
		}
		prestige = 250
		name = EVTOPTB_WCTFT_100
		ai_chance = {
			factor = 0
		}
	}
	
	option = { #Scourge reacts
		trigger = {
			NOT = { character = ROOT }
			religion = death_god
		}
		name = EVTOPTC_WCTFT_100
	}
	
	option = { #Forsaken react
		trigger = {
			NOT = { character = ROOT }
			religion = forsaken_cult
		}
		name = EVTOPTD_WCTFT_100
	}
	
	option = { #Humans react
		trigger = {
			NOT = { 
				character = ROOT
				religion = death_god
				religion = forsaken_cult
			}
			culture_group = human_group
		}
		name = EVTOPTE_WCTFT_100
	}
	
	option = { #Legion reacts
		trigger = {
			NOT = { character = ROOT }
			religion = burning_legion_religion
		}
		name = EVTOPTF_WCTFT_100
	}
	
	option = { #Who cares
		trigger = {
			NOT = { 
				character = ROOT
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				culture_group = human_group
			}
		}
		name = EVTOPTG_WCTFT_100
	}
}

# Additional troops join the cause

# Resistance Calia Path: Garithos victorious, Calia installed
narrative_event = {
	id = WCTFT.110
	title = EVTTITLE_WCTFT_110
	desc = EVTDESC_WCTFT_110
	picture = GFX_evt_stormwind_champion
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	major = yes
	major_trigger = {
		ai = no
	}
	show_root = yes
	
	trigger = {
		NOT = { 
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
			has_global_flag = plaguelands_civil_war_concluded
		}
	}

	immediate = {
		clr_global_flag = plaguelands_civil_war_ongoing
		set_global_flag = plaguelands_civil_war_concluded
		
		#Add Calia to faction
		event_target:target_calia = { join_alliance_faction_effect = yes }
		
		#Vassalize the Grand Marshal
		event_target:target_garithos = {
			set_defacto_liege = event_target:target_calia
		}
		
		#Give nicknames
		event_target:target_calia = {
			give_nickname = nick_the_deliverer
		}
		event_target:target_garithos = {
			give_nickname = nick_the_liberator
			if = {
				limit = {
					has_dlc = "Holy Fury"
				}
				create_bloodline = {
					type = liberator_of_lordaeron
				}
			}
		}
		
		# Resistance Calia Path: The Silver Hand's Loyalties
		73 = { province_event = { id = WCTFT.114 days = 7 } }
	}

	option = { #A new hope for Lordaeron
		trigger = {
			religion = holy_light
		}
		name = EVTOPTA_WCTFT_110
	}
	
	option = { #She won't rule for long
		trigger = {
			OR = {
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
			}
		}
		name = EVTOPTB_WCTFT_110
	}
	
	option = { #At least she can be reasoned with
		trigger = {
			culture = blood_elf
			NOT = {
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				religion = holy_light
			}
		}
		name = EVTOPTC_WCTFT_110
	}

	option = { #Pah!
		trigger = {
			NOT = { 
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				religion = holy_light
				culture = blood_elf
			}
		}
		name = EVTOPTD_WCTFT_110
	}
}

### Resistance Calia Path: The Silver Hand's Loyalties
# Delayer event
province_event = {
	id = WCTFT.114
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		# Calia controls k_lordaeron and is light_group
		k_lordaeron = {
			has_holder = yes
			holder_scope = {
				true_religion_group = light_group
				
				character = event_target:target_calia
			}
		}
	}
	
	immediate = {
		d_order_of_the_silver_hand = { holder_scope = { narrative_event = { id = WCTFT.115 } } }
	}
}
# Delayed event
narrative_event = {
	id = WCTFT.115
	title = EVTTITLE_WCTFT_111
	desc = EVTDESC_WCTFT_111
	picture = GFX_evt_paladin_human
	border = GFX_event_narrative_frame_diplomacy

	is_triggered_only = yes
	
	show_root = yes
	
	trigger = {
		NOT = { 
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
		}
	}
	
	option = { #We stand with Lordaeron
		name = EVTOPTA_WCTFT_111
		
		# Creates d_argent_dawn
		create_d_argent_dawn_effect = yes
		
		# Eastern Silver Hand provinces support the Argent Dawn
		d_order_of_the_silver_hand = {
			holder_scope = { 
				any_vassal = { 
					limit = { capital_scope = { region = world_eastern_kingdoms_lordaeron_eastern_lordaeron } }
					support_argent_dawn_effect = yes
				}
			}
		}
		
		# Makes d_order_of_the_silver_hand vassal of Lordaeron
		d_order_of_the_silver_hand = {
			set_defacto_liege = k_lordaeron
		}
		
		#Calia is pleased
		
		# Notify the world of the split
		hidden_effect = {
			d_argent_dawn = {
				holder_scope = {
					narrative_event = { id = WCTFT.112 }
				}
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
	
	option = { #The Order stands alone
		#Calia is disappointed
		
		name = EVTOPTB_WCTFT_111
		
		ai_chance = {
			factor = 0
		}
	}
}

# Resistance Calia Path: The Argent Dawn is formed
### In this outcome, Scarlet Crusade doesn't form ###
narrative_event = {
	id = WCTFT.112
	title = EVTTITLE_WCTFT_112
	desc = EVTDESC_WCTFT_112
	picture = GFX_evt_paladin_human
	border = GFX_event_narrative_frame_diplomacy

	is_triggered_only = yes
	
	major = yes
	major_trigger = {
		ai = no
	}
	show_root = yes
	
	trigger = {
		NOT = { 
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
		}
	}
	
	option = { #Most unfortunate
		trigger = {
			religion = holy_light
		}
		name = EVTOPTA_WCTFT_112
	}
	
	option = { #Fools
		trigger = {
			NOT = {
				religion = holy_light
			}
		}
		name = EVTOPTB_WCTFT_112
	}
}

# Resistance Garithos Path: Garithos claims the throne
narrative_event = {
	id = WCTFT.120
	title = EVTTITLE_WCTFT_120
	desc = EVTDESC_WCTFT_120
	picture = GFX_evt_stormwind_champion
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	major = yes
	major_trigger = {
		ai = no
	}
	show_root = yes
	
	trigger = {
		NOT = { 
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
			has_global_flag = plaguelands_civil_war_concluded
		}
	}

	immediate = {
		clr_global_flag = plaguelands_civil_war_ongoing
		set_global_flag = plaguelands_civil_war_concluded
		
		#Give nick and bloodline
		event_target:target_garithos = {
			give_nickname = nick_the_usurper
			if = {
				limit = {
					has_dlc = "Holy Fury"
				}
				create_bloodline = {
					type = the_scarlet_king
				}
			}
		}
		
		#Kick out Garithos from faction
		event_target:target_garithos = { leave_alliance_faction_effect = yes }
		
		# Resistance Garithos Path: The Abbendis Schism
		73 = { province_event = { id = WCTFT.124 days = 7 } }
	}

	option = { #This will ruffle some feathers
		trigger = {
			religion = holy_light
		}
		name = EVTOPTA_WCTFT_120
	}
	
	option = { #Let them kill each other
		trigger = {
			OR = {
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
			}
		}
		name = EVTOPTB_WCTFT_120
	}
	
	option = { #The last vestiges of honor are lost
		trigger = {
			culture = blood_elf
			NOT = {
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				religion = holy_light
			}
		}
		name = EVTOPTC_WCTFT_120
	}

	option = { #Disconcerting
		trigger = {
			NOT = { 
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				religion = holy_light
				culture = blood_elf
			}
		}
		name = EVTOPTD_WCTFT_120
	}
}

### Resistance Garithos Path: The Abbendis Schism
# In this outcome Argent Dawn doesn't form #
# Delayer event
province_event = {
	id = WCTFT.124
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		# Garithos controls k_lordaeron and is light_group
		k_lordaeron = {
			has_holder = yes
			holder_scope = {
				true_religion_group = light_group
				
				character = event_target:target_garithos
			}
		}
	}
	
	immediate = {
		### Creates d_scarlet_crusade and d_church_scarlet_light
		create_d_scarlet_crusade_effect = yes
		create_d_church_scarlet_light_effect = yes
		
		### Changes religion_authority
		religious_split_holy_light_bad_effect = yes
		religious_split_scarlet_light_good_effect = yes
		
		# Western Silver Hand provinces support the Scarlet Crusade
		d_order_of_the_silver_hand = {
			holder_scope = { 
				any_vassal = {
					limit = {
						is_potential_scarlet_follower_trigger = yes
						capital_scope = { region = world_eastern_kingdoms_lordaeron_western_lordaeron }
					}
					support_scarlet_light_effect = yes
				}
			}
		}
		
		d_scarlet_crusade = {
			holder_scope = {
				# Makes d_scarlet_crusade vassal of k_lordaeron
				set_defacto_liege = k_lordaeron
				# First leader called High General
				set_special_character_title = "HIGH_GENERAL_TITLE"
				
				# Notification
				narrative_event = { id = WCTFT.125 }
			}
		}
	}
}
# Delayed event
narrative_event = {
	id = WCTFT.125
	title = EVTTITLE_WCTFT_121
	desc = EVTDESC_WCTFT_121
	picture = GFX_evt_paladin_human
	border = GFX_event_narrative_frame_diplomacy

	is_triggered_only = yes

	major = yes
	major_trigger = {
		OR = {
			ai = no
			religion_group = light_group
		}
	}
	show_root = yes
	
	trigger = {
		NOT = { 
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
		}
	}
	
	# Garithos always support the Crusade
	option = {
		trigger = { 
			has_landed_title = k_lordaeron
		}
		name = EVTOPTB_WCLAT_9001
		
		support_scarlet_light_effect = yes
	}
	
	# Doesn't support the Crusade
	option = {
		trigger = { 
			NOT = { has_landed_title = k_lordaeron }
			true_religion = holy_light
		}
		name = EVTOPTB_WCTFT_121
		
		piety = 100

		ai_chance = {
			factor = 50
			
			supports_holy_light_score = yes
		}
	}
	
	# Support the Scarlet Crusade
	option = {
		trigger = {
			NOT = { has_landed_title = k_lordaeron }
			OR = {
				true_religion = scarlet_light
				
				is_potential_scarlet_follower_trigger = yes
			}
		}
		name = EVTOPTB_WCLAT_9001
		
		support_scarlet_light_effect = yes

		ai_chance = {
			factor = 50
			
			supports_scarlet_light_score = yes
		}
	}
	
	option = { #Evil reaction
		trigger = {
			NOT = { has_landed_title = k_lordaeron }
			evil_true_religion_trigger = yes
		}
		name = EVTOPTD_WCTFT_121
	}
	
	option = { #Everyone else's reaction
		trigger = { 
			NOT = {
				has_landed_title = k_lordaeron
				true_religion = holy_light
				true_religion = scarlet_light
				evil_true_religion_trigger = no
			}
		}
		name = EVTOPTE_WCTFT_121
	}
	
	after = {
		tooltip = {
			religious_split_holy_light_bad_effect = yes
			religious_split_scarlet_light_good_effect = yes
		}
	}
}

# Forsaken Path: Sylvanas victorious
narrative_event = {
	id = WCTFT.130
	title = EVTTITLE_WCTFT_130
	desc = EVTDESC_WCTFT_130
	picture = GFX_evt_scourge_march
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	major = yes
	major_trigger = {
		ai = no
	}
	show_root = yes
	
	trigger = {
		NOT = { 
			has_game_rule = {
				name = frozen_throne_story
				value = off
			}
			has_global_flag = plaguelands_civil_war_concluded
		}
	}

	immediate = {
		clr_global_flag = plaguelands_civil_war_ongoing
		set_global_flag = plaguelands_civil_war_concluded
		
		#Destroy any kingdom titles other than k_forsaken
		any_demesne_title = {
			limit = {
				tier = KING
				title_can_be_lost_trigger = yes
				NOT = { title = k_forsaken }
			}
			destroy_landed_title = THIS
		}
		
		#Ping Saidan or create the Grand Crusader of Scarlet Crusade
	}

	option = { #It's over
		trigger = {
			religion = holy_light
		}
		name = EVTOPTA_WCTFT_130
	}
	
	option = { #We will slaughter anyone who stands in our way
		trigger = {
			religion = forsaken_cult
		}
		name = EVTOPTB_WCTFT_130
	}
	
	option = { #Treacherous scum
		trigger = {
			OR = {
				religion = death_god
				religion = burning_legion_religion
			}
		}
		name = EVTOPTC_WCTFT_130
	}
	
	option = { #Our fallen champion
		trigger = {
			culture = blood_elf
			NOT = {
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				religion = holy_light
			}
		}
		name = EVTOPTD_WCTFT_130
	}

	option = { #Looks like the balance of power has changed
		trigger = {
			NOT = { 
				religion = death_god
				religion = forsaken_cult
				religion = burning_legion_religion
				religion = holy_light
				culture = blood_elf
			}
		}
		name = EVTOPTE_WCTFT_130
	}
}

# Forsaken Path: Saidan and Renault make a deal

# Forsaken Path: Renault murders Alexandros

# Forsaken Path: Silver Hand splinters into Scarlets and Argents
### Canon outcome - Argents and Scarlets both form ###

# Forsaken Path: Send a diplomat to the Horde?

# Forsaken Path: The Warchief's Decision

### War of the Frozen Throne ###

# Illidari Victory: Scourge Collapse

# Illidari Victory: The Prince's Return

# Illidari Defeat: Illidari Collapse