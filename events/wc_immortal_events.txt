namespace = WCIMM

#on_startup
# Starts ruled too long timer
character_event = {
	id = WCIMM.10
	
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		is_playable = yes
		
		NOT = { has_character_flag = ruled_too_long_timer_flag }
	}
	
	immediate = {
		set_character_flag = ruled_too_long_timer_flag
		
		character_event = { id = WCIMM.20 years = 50 }
	}
}
#on_new_holder on_new_holder_inheritance on_new_holder_usurpation
# Starts/clears ruled too long timer
character_event = {
	id = WCIMM.15
	
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		OR = {
			AND = {
				is_playable = yes
				NOT = { has_character_flag = ruled_too_long_timer_flag }
			}
			FROMFROM = {
				is_playable = no
				has_character_flag = ruled_too_long_timer_flag
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_playable = yes
				NOT = { has_character_flag = ruled_too_long_timer_flag }
			}
			set_character_flag = ruled_too_long_timer_flag
			
			character_event = { id = WCIMM.20 years = 50 }
		}
		if = {
			limit = {
				FROMFROM = {
					is_playable = no
					has_character_flag = ruled_too_long_timer_flag
				}
			}
			FROMFROM = { character_event = { id = WCIMM.30 } }
		}
	}
}
#Ruled too long
character_event = {
	id = WCIMM.20
	desc = EVTDESC_WCIMM_20
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		is_playable = yes
		
		has_character_flag = ruled_too_long_timer_flag
	}
	
	fail_trigger_effect = {
		clr_character_flag = ruled_too_long_timer_flag
	}
	
	immediate = {
		character_event = { id = WCIMM.20 years = 50 }
	}
	
	option = {
		name = EVTOPTA_WCIMM_20
		
		add_character_modifier = { name = ruled_too_long_modifier duration = -1 stacking = yes }
	}
}
# Clears ruled too long modifier when becomes unplayable
character_event = {
	id = WCIMM.30
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_character_flag = ruled_too_long_timer_flag
	}
	
	immediate = {
		log = "WCIMM.30 fired for [Root.GetBestName]"
		
		clr_character_flag = ruled_too_long_timer_flag
		
		remove_character_modifiers = {
			modifier = ruled_too_long_modifier
			amount = 30
		}
		
		clear_delayed_event = { id = WCIMM.20 }
	}
}