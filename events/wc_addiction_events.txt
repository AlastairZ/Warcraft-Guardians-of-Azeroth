namespace = WCADD

### Magical addiction ###
#
# Ways to satisfy the addiction:
# - Be a worshiper of fel_group or consuming_fel_magic_flag
# - Be a worshiper of void_group or consuming_void_magic_flag
# - Mana crystals
# P.S. If character is consuming_<fel/void>_magic_flag, it's also receiving fel/void corruption
# (check events WCFEL.95 and WCVOD.95)
#
# Satisfy magical addiction of others (if you're a Fel/Void worshiper)
# character_event = {
	# id = WCADD.1045
	# picture = GFX_evt_vorna_the_wretched
	# desc = EVTDESC_WCTHW_1045
	# border = GFX_event_normal_frame_religion

	# is_triggered_only = yes

	# # The Fel will help them!
	# option = {
		# trigger = { true_religion_group = fel_group }
		# name = EVTOPTA_WCTHW_1045

		# if = {
			# limit = { has_secret_religion = yes }
			# convert_to_secret_religion = yes
		# }
		# drain_fel_source_effect = yes
	# }
	# # Look into the Void!
	# option = {
		# trigger = { true_religion_group = void_group }
		# name = EVTOPTB_WCTHW_1045

		# if = {
			# limit = { has_secret_religion = yes }
			# convert_to_secret_religion = yes
		# }
		# drain_void_source_effect = yes
	# }
	# # They're not prepared!
	# option = {
		# name = EVTOPTC_WCTHW_1045

		# ai_chance = {
			# factor = 0
		# }
	# }
# }
# Magical addiction
character_event = {
	id = WCADD.1050
	picture = GFX_evt_vorna_the_wretched
	desc = EVTDESC_WCADD_1050
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	only_capable = yes
	only_playable = yes

	trigger = {
		is_playable = yes
		
		is_alive = yes
		is_dying = no

		has_magical_addiction_trigger = yes
	}

	# Try to get a mana crystal
	option = {
		name = EVTOPTA_WCTHW_1050

		if = { limit = { trait = has_magical_withdrawal } remove_trait = has_magical_withdrawal }
		hidden_effect = {
			any_courtier_or_vassal = {
				limit = {
					is_playable = no
					
					trait = has_magical_withdrawal
				}
				remove_trait = has_magical_withdrawal
			}
		}
		add_character_modifier = { name = buying_mana_crystals years = 5 }

		ai_chance = {
			factor = 40
		}
	}
	# Find another way
	option = {
		trigger = {
			is_adult = yes
			is_playable = yes

			NOT = { has_character_flag = tried_to_find_way_to_satisfy_hunger_flag }

			learning = 15
		}
		name = EVTOPTB_WCTHW_1050

		set_character_flag = tried_to_find_way_to_satisfy_hunger_flag

		character_event = { id = WCADD.1055 days = 30 random = 30 }

		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				independent = yes
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = stubborn
			}
			modifier = {
				factor = 0
				NOT = { trait = cynical }
			}
		}
	}
	# If your liege are consuming Fel/Void magic
	option = {
		trigger = {
			OR = {
				ai = no
				NOT = { has_character_flag = ai_refused_dark_magic_flag }
			}
			liege = {
				OR = {
					religion_group = fel_group
					religion_group = void_group
					has_character_flag = consuming_fel_magic_flag
					has_character_flag = consuming_void_magic_flag
				}
			}
		}
		name = EVTOPTC_WCTHW_1050

		if = {
			limit = {
				liege = {
					OR = {
						religion_group = fel_group
						has_character_flag = consuming_fel_magic_flag
					}
				}
			}
			drain_fel_source_effect = yes
		}
		else = {
			drain_void_source_effect = yes
		}

		ai_chance = {
			factor = 50
		}
	}
	# I can't...
	option = {
		name = EVTOPTD_WCTHW_1050

		if = { limit = { NOT = { trait = has_magical_withdrawal } } add_trait = has_magical_withdrawal }
		hidden_effect = {
			any_courtier_or_vassal = {
				limit = {
					is_playable = no
					
					NOT = { trait = has_magical_withdrawal }
					
					has_magical_addiction_trigger = yes
				}
				add_trait = has_magical_withdrawal
			}
		}

		ai_chance = {
			factor = 0
		}
	}
}
# Another ways
character_event = {
	id = WCADD.1055
	picture = GFX_evt_vorna_the_wretched
	desc = EVTDESC_WCTHW_1055
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		NOR = {
			true_religion_group = fel_group
			true_religion_group = void_group
			has_character_flag = consuming_fel_magic_flag
			has_character_flag = consuming_void_magic_flag
		}
	}

	# Use Fel magic
	option = {
		name = EVTOPTA_WCTHW_1055

		set_character_flag = chose_fel_magic_flag
		long_character_event = { id = WCADD.1060 days = 15 random = 15 }

		ai_chance = {
			factor = 75
		}
	}
	# Use Void magic
	option = {
		name = EVTOPTB_WCTHW_1055

		set_character_flag = chose_void_magic_flag
		long_character_event = { id = WCADD.1060 days = 15 random = 15 }

		ai_chance = {
			factor = 25
		}
	}
	# Refuse this idea
	option = {
		name = EVTOPTC_WCTHW_1055

		ai_chance = {
			factor = 0
		}
	}
}
long_character_event = {
	id = WCADD.1060
	desc = {
		trigger = { has_character_flag = chose_fel_magic_flag }
		text = EVTDESC_WCTHW_1060_fel
		picture = GFX_evt_fel_storm
	}
	desc = {
		trigger = { has_character_flag = chose_void_magic_flag }
		text = EVTDESC_WCTHW_1060_void
		picture = GFX_evt_voidwalker
	}
	border = GFX_event_long_frame_religion

	is_triggered_only = yes

	trigger = {
		NOR = {
			true_religion_group = fel_group
			true_religion_group = void_group
			has_character_flag = consuming_fel_magic_flag
			has_character_flag = consuming_void_magic_flag
		}
	}
	
	fail_trigger_effect = {
		clr_character_flag = chose_fel_magic_flag
		clr_character_flag = chose_void_magic_flag
	}

	# This is a necessary measure!
	option = {
		name = EVTOPTA_WCTHW_1060

		if = {
			limit = { has_character_flag = chose_fel_magic_flag }
			drain_fel_source_effect = yes
		}
		else_if = {
			limit = { has_character_flag = chose_void_magic_flag }
			drain_void_source_effect = yes
		}
	}
	# We will never sink so low!
	option = {
		name = EVTOPTB_WCTHW_1060

		ai_chance = {
			factor = 0
		}
	}
	
	after = {
		clr_character_flag = chose_fel_magic_flag
		clr_character_flag = chose_void_magic_flag
	}
}
# FROM has found way to satisfy hunger
letter_event = {
	id = WCADD.1065
	desc = EVTDESC_WCTHW_1065
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	# This is a necessary measure!
	option = {
		name = EVTOPTA_WCTHW_1060

		if = {
			limit = {
				liege = {
					OR = {
						religion_group = fel_group
						has_character_flag = consuming_fel_magic_flag
					}
				}
			}
			drain_fel_source_effect = yes
		}
		else_if = {
			limit = {
				liege = {
					OR = {
						religion_group = void_group
						has_character_flag = consuming_void_magic_flag
					}
				}
			}
			drain_void_source_effect = yes
		}

		ai_chance = {
			factor = 50
			
			evil_ai_chance_score = yes
			evil_ai_chance_religion_score = yes
		}
	}
	# We will never sink so low!
	option = {
		name = EVTOPTB_WCTHW_1060

		set_character_flag = ai_refused_dark_magic_flag
		
		reverse_opinion = { modifier = opinion_very_disappointed who = FROM years = 5 }
		FROM = { letter_event = { id = WCADD.1066 days = 15 random = 15 } }

		ai_chance = {
			factor = 50
		}
	}
}
# FROM has refused to use Fel/Void magic
letter_event = {
	id = WCADD.1066
	desc = EVTDESC_WCTHW_1066
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = ALAS
	}
}